{"version":3,"sources":["views/video/components/VideoProvider/useSelectedParticipant/useSelectedParticipant.tsx","views/video/utils/index.ts","views/video/hooks/useLocalVideoToggle/useLocalVideoToggle.tsx","views/video/components/VideoProvider/AttachVisibilityHandler/AttachVisibilityHandler.tsx","views/video/constants.ts","views/video/components/VideoProvider/useRoom/useRoom.tsx","views/video/components/VideoProvider/index.tsx","views/video/components/VideoProvider/useLocalTracks/useLocalTracks.ts","views/video/components/VideoProvider/useHandleRoomDisconnectionErrors/useHandleRoomDisconnectionErrors.ts","views/video/components/VideoProvider/useHandleTrackPublicationFailed/useHandleTrackPublicationFailed.ts","views/video/components/VideoProvider/useHandleOnDisconnect/useHandleOnDisconnect.ts","views/video/hooks/useVideoContext/useVideoContext.ts","views/video/components/Controls/EndCallButton/EndCallButton.tsx","views/video/hooks/useIsTrackEnabled/useIsTrackEnabled.tsx","views/video/components/Controls/ToggleAudioButton/ToggleAudioButton.tsx","views/video/hooks/useLocalAudioToggle/useLocalAudioToggle.tsx","views/video/components/Controls/ToggleVideoButton/ToggleVideoButton.tsx","views/video/hooks/useScreenShareParticipant/useScreenShareParticipant.tsx","views/video/components/Controls/ToogleScreenShareButton/ToggleScreenShareButton.tsx","views/video/hooks/useScreenShareToggle/useScreenShareToggle.tsx","views/video/hooks/useRoomState/useRoomState.tsx","views/video/components/Controls/Controls.tsx","views/video/components/Controls/useIsUserActive/useIsUserActive.ts","views/video/hooks/useMediaStreamTrack/useMediaStreamTrack.ts","views/video/components/VideoTrack/VideoTrack.tsx","views/video/components/LocalVideoPreview/LocalVideoPreview.tsx","views/video/components/MenuBar/ToggleFullScreenButton/ToggleFullScreenButton.tsx","views/video/hooks/useFullScreenToggle/useFullScreenToggle.tsx","views/video/state/settings/settingsReducer.ts","views/video/state/index.tsx","views/video/components/MenuBar/AboutDialog/AboutDialog.tsx","views/video/state/settings/renderDimensions.ts","views/video/components/MenuBar/ConnectionOptions/ConnectionOptions.tsx","views/video/components/AudioLevelIndicator/AudioLevelIndicator.tsx","views/video/components/MenuBar/DeviceSelector/LocalAudioLevelIndicator/LocalAudioLevelIndicator.tsx","views/video/components/MenuBar/DeviceSelector/deviceHooks/deviceHooks.tsx","views/video/components/MenuBar/DeviceSelector/AudioInputList/AudioInputList.tsx","views/video/components/MenuBar/DeviceSelector/AudioOutputList/AudioOutputList.tsx","views/video/components/MenuBar/DeviceSelector/VideoInputList/VideoInputList.tsx","views/video/components/MenuBar/DeviceSelector/DeviceSelector.tsx","views/video/components/MenuBar/SettingsDialog/SettingsDialog.tsx","views/video/components/MenuBar/Menu/Menu.tsx","views/video/components/MenuBar/FlipCameraButton/FlipCameraButton.tsx","views/video/components/MenuBar/MenuBar.tsx","views/video/components/ReconnectingNotification/ReconnectingNotification.tsx","views/video/components/BandwidthWarning/BandwidthWarning.tsx","views/video/components/NewtorkQualityLevel/NetworkQualityLevel.tsx","views/video/components/ParticipantInfo/ParticipantConnectionIndicator/ParticipantConnectionIndicator.tsx","views/video/hooks/useParticipantIsReconnecting/useParticipantIsReconnecting.ts","views/video/components/ParticipantInfo/PinIcon/PinIcon.tsx","views/video/hooks/usePublications/usePublications.tsx","views/video/hooks/useIsTrackSwitchedOff/useIsTrackSwitchedOff.tsx","views/video/hooks/useTrack/useTrack.tsx","views/video/components/ParticipantInfo/ParticipantInfo.tsx","views/video/hooks/useParticipantNetworkQualityLevel/useParticipantNetworkQualityLevel.tsx","views/video/components/AudioTrack/AudioTrack.tsx","views/video/components/Publication/Publication.tsx","views/video/components/ParticipantTracks/ParticipantTracks.tsx","views/video/components/Participant/Participant.tsx","views/video/hooks/useDominantSpeaker/useDominantSpeaker.tsx","views/video/hooks/useParticipants/useParticipants.tsx","views/video/components/ParticipantStrip/ParticipantStrip.tsx","views/video/components/MainParticipantInfo/MainParticipantInfo.tsx","views/video/components/MainParticipant/MainParticipant.tsx","views/video/hooks/useMainSpeaker/useMainSpeaker.tsx","views/video/components/Room/Room.tsx","views/video/App.tsx","views/video/hooks/useHeight/useHeight.ts","views/video/components/ErrorDialog/ErrorDialog.tsx","views/video/components/ErrorDialog/enhanceMessage.ts","views/video/theme.ts","views/video/utils/useConnectionOptions/useConnectionOptions.ts","views/video/components/UnsupportedBrowserWarning/UnsupportedBrowserWarning.tsx","views/video/index.tsx"],"names":["selectedParticipantContext","createContext","useSelectedParticipant","useContext","SelectedParticipantProvider","room","children","useState","selectedParticipant","_setSelectedParticipant","useEffect","onDisconnect","on","off","Provider","value","participant","prevParticipant","isMobile","navigator","userAgent","test","useLocalVideoToggle","useVideoContext","localParticipant","localTracks","getLocalVideoTrack","removeLocalVideoTrack","onError","videoTrack","find","track","name","includes","isPublishing","setIspublishing","previousDeviceIdRef","useRef","toggleVideoEnabled","useCallback","current","mediaStreamTrack","getSettings","deviceId","localTrackPublication","unpublishTrack","emit","exact","then","publishTrack","priority","catch","finally","AttachVisibilityHandler","isVideoEnabled","shouldRepublishVideoOnForeground","handleVisibilityChange","document","visibilityState","addEventListener","removeEventListener","DEFAULT_VIDEO_CONSTRAINTS","width","height","frameRate","window","TwilioVideo","Video","VideoContext","VideoProvider","options","onErrorCallback","error","console","log","message","audioTrack","setAudioTrack","setVideoTrack","isAcquiringLocalTracks","setIsAcquiringLocalTracks","getLocalAudioTrack","createLocalAudioTrack","newTrack","newOptions","Date","now","createLocalVideoTrack","stop","undefined","createLocalTracks","video","audio","tracks","kind","filter","useLocalTracks","EventEmitter","setRoom","isConnecting","setIsConnecting","localTracksRef","optionsRef","connect","token","newRoom","disconnect","once","setTimeout","twilioRoom","forEach","useRoom","onDisconnected","useHandleRoomDisconnectionErrors","useHandleTrackPublicationFailed","useHandleOnDisconnect","context","Error","useStyles","makeStyles","theme","createStyles","fab","margin","spacing","background","color","outline","EndCallButton","classes","Tooltip","title","onClick","placement","PopperProps","disablePortal","Fab","className","useIsTrackEnabled","isEnabled","setIsEnabled","setEnabled","setDisabled","ToggleAudioButton","props","disable","enable","useLocalAudioToggle","isAudioEnabled","toggleAudioEnabled","disabled","data-cy-audio-toggle","ToggleVideoButton","lastClickTimeRef","toggleVideo","useScreenShareParticipant","screenShareParticipant","setScreenShareParticipant","state","updateScreenShareParticipant","Array","from","participants","values","concat","trackName","backgroundColor","ToggleScreenShareButton","isSharing","setIsSharing","stopScreenShareRef","shareScreen","mediaDevices","getDisplayMedia","stream","getTracks","trackPublication","onended","toggleScreenShare","useScreenShareToggle","isScreenShared","disableScreenShareButton","isScreenShareSupported","isDisabled","tooltipMessage","style","cursor","useRoomState","setState","setRoomState","container","display","position","right","transform","bottom","zIndex","transition","opacity","visibility","maxWidth","breakpoints","down","sidebarMobileHeight","Controls","roomState","isReconnecting","showControls","isUserActive","setIsUserActive","timeoutIDRef","handleUserActivity","throttle","clearTimeout","timeoutID","useIsUserActive","clsx","useMediaStreamTrack","setMediaStreamTrack","handleStarted","styled","maxHeight","objectFit","VideoTrack","isLocal","ref","el","muted","setPriority","attach","detach","isFrontFacing","facingMode","LocalVideoPreview","ToggleFullscreenButton","fscreen","fullscreenElement","isFullScreen","setIsFullScreen","onFullScreenChange","toggleFullScreen","exitFullscreen","requestFullscreen","documentElement","useFullScreenToggle","fullscreenEnabled","IconButton","aria-label","initialSettings","trackSwitchOffMode","dominantSpeakerPriority","bandwidthProfileMode","maxTracks","maxAudioBitrate","renderDimensionLow","renderDimensionStandard","renderDimensionHigh","inputLabels","target","setting","settingsReducer","action","StateContext","AppStateProvider","setError","isFetching","setIsFetching","activeSinkId","setActiveSinkId","useReducer","settings","dispatchSetting","contextValue","getToken","identity","roomName","a","headers","Headers","endpoint","params","URLSearchParams","authApi","res","err","data","errors","Promise","reject","useAppState","AboutDialog","open","onClose","roomType","Dialog","fullWidth","DialogTitle","DialogContent","DialogContentText","String","isSupported","version","appVersion","process","REACT_APP_GIT_TAG","REACT_APP_GIT_COMMIT","DialogActions","Button","autoFocus","RenderDimensions","label","resolution","getResolution","item","formControl","withDefault","val","RenderDimensionItems","map","MenuItem","key","ConnectionOptions","hidden","handleChange","e","handleNumberChange","Grid","xs","Typography","variant","sm","FormControl","InputLabel","id","Select","onChange","TextField","placeholder","audioContext","clipId","AudioContext","webkitAudioContext","initializeAnalyser","audioSource","createMediaStreamSource","analyser","createAnalyser","smoothingTimeConstant","fftSize","React","memo","size","SIZE","SVGRectRef","setAnalyser","isTrackEnabled","newMediaStream","MediaStream","clone","stopAllMediaStreamTracks","reinitializeAnalyser","SVGClipElement","sampleArray","Uint8Array","frequencyBinCount","timer","interval","getByteFrequencyData","length","i","volume","Math","min","max","log10","setAttribute","clipPathId","focusable","viewBox","aria-hidden","x","y","fill","d","clipPath","data-cy-audio-mute-icon","LocalAudioLevelIndicator","useDevices","devices","setDevices","getDevices","enumerateDevices","every","device","shouldAskForMediaPermissions","getUserMedia","mediaStream","alignItems","justifyContent","AudioInputList","audioInputDevices","localAudioTrack","localAudioInputDeviceId","newDeviceId","restart","AudioOutputList","audioOutputDevices","activeOutputLabel","preview","VideoInputList","videoInputDevices","localVideoTrack","localVideoInputDeviceId","listSection","DeviceSelector","minHeight","button","float","paper","SettingsDialog","selectedTab","setSelectedTab","Tabs","_","newValue","Tab","Menu","user","aboutOpen","setAboutOpen","setMenuOpen","settingsOpen","setSettingsOpen","anchorRef","FlipCameraButton","supportsFacingMode","setSupportsFacingMode","toggleFacingMode","newFacingMode","palette","default","toolbar","padding","rightButtonContainer","marginLeft","form","flexWrap","up","textField","marginRight","loadingSpinner","displayName","minWidth","fontWeight","joinButton","MenuBar","URLRoomName","useParams","profile","useSelector","auth","setRoomName","userId","AppBar","Toolbar","snackbar","icon","ReconnectingNotification","Snackbar","anchorOrigin","vertical","horizontal","SnackbarContent","BandwidthWarningContainer","flexDirection","Warning","textAlign","BandwidthWarning","fontSize","Container","border","boxSizing","borderRight","NetworkQualityLevel","qualityLevel","level","indicator","borderRadius","ParticipantConnectionIndicator","setIsReconnecting","handleReconnecting","handleReconnected","useParticipantIsReconnecting","PinIcon","SvgIcon","usePublications","publications","setPublications","publicationAdded","publication","prevPublications","publicationRemoved","p","useIsTrackSwitchedOff","isSwitchedOff","setIsSwitchedOff","handleSwitchedOff","handleSwitchedOn","useTrack","setTrack","removeTrack","sidebarWidth","overflow","stroke","strokeWidth","isVideoSwitchedOff","infoContainer","hideVideo","infoRow","ParticipantInfo","isSelected","audioPublication","videoPublication","networkQualityLevel","setNetworkQualityLevel","handleNewtorkQualityLevelChange","newNetworkQualityLevel","useParticipantNetworkQualityLevel","Boolean","isScreenShareEnabled","data-cy-participant","AudioTrack","audioEl","body","appendChild","remove","setSinkId","Publication","disableAudio","videoPriority","ParticipantTracks","filteredPublications","enableScreenShare","some","Participant","useDominantSpeaker","dominantSpeaker","setDominantSpeaker","handleDominantSpeakerChanged","newDominantSpeaker","handleParticipantDisconnected","prevDominantSpeaker","useParticipants","setParticipants","prevParticipants","participantConnected","participantDisconnected","overflowY","overflowX","ScrollContainer","ParticipantStrip","setSelectedParticipant","sid","gridArea","MainParticipantInfo","screenSharePublication","data-cy-main-participant","MainParticipant","mainParticipant","useMainSpeaker","gridTemplateColumns","gridTemplateAreas","gridTemplateRows","gridGap","Room","Main","App","innerHeight","visualViewport","scale","setHeight","onResize","useHeight","ErrorDialog","dismissError","code","enhancedMessage","enhanceMessage","createMuiTheme","type","primary","main","useConnectionOptions","connectionOptions","bandwidthProfile","mode","renderDimensions","low","standard","high","Number","networkQuality","local","remote","preferredVideoCodecs","codec","simulcast","maxSubscriptionBitrate","removeUndefineds","obj","isPlainObject","marginTop","heading","marginBottom","justify","Paper","Link","href","rel","VideoApp","UnsupportedBrowserWarning","VideoScreen","CssBaseline"],"mappings":"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","file":"static/js/20.0e117a21.chunk.js","sourcesContent":["import React, { createContext, useContext, useState, useEffect } from 'react';\r\nimport { Participant, Room } from 'twilio-video';\r\n\r\ntype selectedParticipantContextType = [Participant | null, (participant: Participant) => void];\r\n\r\nexport const selectedParticipantContext = createContext<selectedParticipantContextType>(null!);\r\n\r\nexport default function useSelectedParticipant() {\r\n  const [selectedParticipant, setSelectedParticipant] = useContext(selectedParticipantContext);\r\n  return [selectedParticipant, setSelectedParticipant] as const;\r\n}\r\n\r\ntype SelectedParticipantProviderProps = {\r\n  room: Room;\r\n  children: React.ReactNode;\r\n};\r\n\r\nexport function SelectedParticipantProvider({ room, children }: SelectedParticipantProviderProps) {\r\n  const [selectedParticipant, _setSelectedParticipant] = useState<Participant | null>(null);\r\n  const setSelectedParticipant = (participant: Participant) =>\r\n    _setSelectedParticipant(prevParticipant => (prevParticipant === participant ? null : participant));\r\n\r\n  useEffect(() => {\r\n    const onDisconnect = () => _setSelectedParticipant(null);\r\n    room.on('disconnected', onDisconnect);\r\n    return () => {\r\n      room.off('disconnected', onDisconnect);\r\n    };\r\n  }, [room]);\r\n\r\n  return (\r\n    <selectedParticipantContext.Provider value={[selectedParticipant, setSelectedParticipant]}>\r\n      {children}\r\n    </selectedParticipantContext.Provider>\r\n  );\r\n}\r\n","import isPlainObject from 'is-plain-object';\r\n\r\nexport const isMobile = (() => {\r\n  if (typeof navigator === 'undefined' || typeof navigator.userAgent !== 'string') {\r\n    return false;\r\n  }\r\n  return /Mobile/.test(navigator.userAgent);\r\n})();\r\n\r\n// This function ensures that the user has granted the browser permission to use audio and video\r\n// devices. If permission has not been granted, it will cause the browser to ask for permission\r\n// for audio and video at the same time (as opposed to separate requests).\r\nexport function ensureMediaPermissions() {\r\n  return navigator.mediaDevices\r\n    .enumerateDevices()\r\n    .then(devices => devices.every(device => !(device.deviceId && device.label)))\r\n    .then(shouldAskForMediaPermissions => {\r\n      if (shouldAskForMediaPermissions) {\r\n        return navigator.mediaDevices\r\n          .getUserMedia({ audio: true, video: true })\r\n          .then(mediaStream => mediaStream.getTracks().forEach(track => track.stop()));\r\n      }\r\n    });\r\n}\r\n\r\n// Recursively removes any object keys with a value of undefined\r\nexport function removeUndefineds<T>(obj: T): T {\r\n  if (!isPlainObject(obj)) return obj;\r\n\r\n  const target: { [name: string]: any } = {};\r\n\r\n  for (const key in obj) {\r\n    const val = obj[key];\r\n    if (typeof val !== 'undefined') {\r\n      target[key] = removeUndefineds(val);\r\n    }\r\n  }\r\n\r\n  return target as T;\r\n}\r\n","import { LocalVideoTrack } from 'twilio-video';\r\nimport { useCallback, useRef, useState } from 'react';\r\nimport useVideoContext from '../useVideoContext/useVideoContext';\r\n\r\nexport default function useLocalVideoToggle() {\r\n  const {\r\n    room: { localParticipant },\r\n    localTracks,\r\n    getLocalVideoTrack,\r\n    removeLocalVideoTrack,\r\n    onError,\r\n  } = useVideoContext();\r\n  const videoTrack = localTracks.find(track => track.name.includes('camera')) as LocalVideoTrack;\r\n  const [isPublishing, setIspublishing] = useState(false);\r\n  const previousDeviceIdRef = useRef<string>();\r\n\r\n  const toggleVideoEnabled = useCallback(() => {\r\n    if (!isPublishing) {\r\n      if (videoTrack) {\r\n        previousDeviceIdRef.current = videoTrack.mediaStreamTrack.getSettings().deviceId;\r\n        const localTrackPublication = localParticipant?.unpublishTrack(videoTrack);\r\n        // TODO: remove when SDK implements this event. See: https://issues.corp.twilio.com/browse/JSDK-2592\r\n        localParticipant?.emit('trackUnpublished', localTrackPublication);\r\n        removeLocalVideoTrack();\r\n      } else {\r\n        setIspublishing(true);\r\n        getLocalVideoTrack({ deviceId: { exact: previousDeviceIdRef.current } })\r\n          .then((track: LocalVideoTrack) => localParticipant?.publishTrack(track, { priority: 'low' }))\r\n          .catch(onError)\r\n          .finally(() => setIspublishing(false));\r\n      }\r\n    }\r\n  }, [videoTrack, localParticipant, getLocalVideoTrack, isPublishing, onError, removeLocalVideoTrack]);\r\n\r\n  return [!!videoTrack, toggleVideoEnabled] as const;\r\n}\r\n","import { isMobile } from '../../../utils';\r\nimport { useEffect, useRef } from 'react';\r\nimport useLocalVideoToggle from '../../../hooks/useLocalVideoToggle/useLocalVideoToggle';\r\nimport useVideoContext from '../../../hooks/useVideoContext/useVideoContext';\r\n\r\n/* \r\n  This component adds a visibilitychange handler to the document when\r\n  the user is using a mobile device. When the handler detects that\r\n  the browser has been backgrounded, it unpublishes the users local\r\n  video track. The browser cannot send video to the room when it has\r\n  been backgrounded, so unpublishing the track stops video capture\r\n  on the device, and triggers a UI update for all other participants\r\n  to show that this user's video track has been turned off.\r\n*/\r\n\r\nexport default function AttachVisibilityHandler() {\r\n  const { room } = useVideoContext();\r\n  const [isVideoEnabled, toggleVideoEnabled] = useLocalVideoToggle();\r\n  const shouldRepublishVideoOnForeground = useRef(false);\r\n\r\n  useEffect(() => {\r\n    if (isMobile) {\r\n      const handleVisibilityChange = () => {\r\n        // We don't need to unpublish the local video track if it has already been unpublished\r\n        if (document.visibilityState === 'hidden' && isVideoEnabled) {\r\n          shouldRepublishVideoOnForeground.current = true;\r\n          toggleVideoEnabled();\r\n\r\n          // Don't publish the local video track if it wasn't published before the app was backgrounded\r\n        } else if (shouldRepublishVideoOnForeground.current) {\r\n          shouldRepublishVideoOnForeground.current = false;\r\n          toggleVideoEnabled();\r\n        }\r\n      };\r\n\r\n      document.addEventListener('visibilitychange', handleVisibilityChange);\r\n      return () => {\r\n        document.removeEventListener('visibilitychange', handleVisibilityChange);\r\n      };\r\n    }\r\n  }, [isVideoEnabled, room, toggleVideoEnabled]);\r\n\r\n  return null;\r\n}\r\n","export const DEFAULT_VIDEO_CONSTRAINTS: MediaStreamConstraints['video'] = {\r\n  width: 1280,\r\n  height: 720,\r\n  frameRate: 24,\r\n};\r\n","import { Callback } from '../../../types';\r\nimport EventEmitter from 'events';\r\nimport { isMobile } from '../../../utils';\r\nimport Video, { ConnectOptions, LocalTrack, Room } from 'twilio-video';\r\nimport { useCallback, useEffect, useRef, useState } from 'react';\r\n\r\n// @ts-ignore\r\nwindow.TwilioVideo = Video;\r\n\r\nexport default function useRoom(localTracks: LocalTrack[], onError: Callback, options?: ConnectOptions) {\r\n  const [room, setRoom] = useState<Room>(new EventEmitter() as Room);\r\n  const [isConnecting, setIsConnecting] = useState(false);\r\n  const localTracksRef = useRef<LocalTrack[]>([]);\r\n  const optionsRef = useRef(options);\r\n\r\n  useEffect(() => {\r\n    // It can take a moment for Video.connect to connect to a room. During this time, the user may have enabled or disabled their\r\n    // local audio or video tracks. If this happens, we store the localTracks in this ref, so that they are correctly published\r\n    // once the user is connected to the room.\r\n    localTracksRef.current = localTracks;\r\n  }, [localTracks]);\r\n\r\n  useEffect(() => {\r\n    // This allows the connect function to always access the most recent version of the options object. This allows us to\r\n    // reliably use the connect function at any time.\r\n    optionsRef.current = options;\r\n  }, [options]);\r\n\r\n  const connect = useCallback(\r\n    token => {\r\n      setIsConnecting(true);\r\n      return Video.connect(token, { ...optionsRef.current, tracks: [] }).then(\r\n        newRoom => {\r\n          setRoom(newRoom);\r\n          const disconnect = () => newRoom.disconnect();\r\n\r\n          newRoom.once('disconnected', () => {\r\n            // Reset the room only after all other `disconnected` listeners have been called.\r\n            setTimeout(() => setRoom(new EventEmitter() as Room));\r\n            window.removeEventListener('beforeunload', disconnect);\r\n\r\n            if (isMobile) {\r\n              window.removeEventListener('pagehide', disconnect);\r\n            }\r\n          });\r\n\r\n          // @ts-ignore\r\n          window.twilioRoom = newRoom;\r\n\r\n          localTracksRef.current.forEach(track =>\r\n            // Tracks can be supplied as arguments to the Video.connect() function and they will automatically be published.\r\n            // However, tracks must be published manually in order to set the priority on them.\r\n            // All video tracks are published with 'low' priority. This works because the video\r\n            // track that is displayed in the 'MainParticipant' component will have it's priority\r\n            // set to 'high' via track.setPriority()\r\n            newRoom.localParticipant.publishTrack(track, { priority: track.kind === 'video' ? 'low' : 'standard' })\r\n          );\r\n\r\n          setIsConnecting(false);\r\n\r\n          // Add a listener to disconnect from the room when a user closes their browser\r\n          window.addEventListener('beforeunload', disconnect);\r\n\r\n          if (isMobile) {\r\n            // Add a listener to disconnect from the room when a mobile user closes their browser\r\n            window.addEventListener('pagehide', disconnect);\r\n          }\r\n        },\r\n        error => {\r\n          onError(error);\r\n          setIsConnecting(false);\r\n        }\r\n      );\r\n    },\r\n    [onError]\r\n  );\r\n\r\n  return { room, isConnecting, connect };\r\n}\r\n","import React, { createContext, ReactNode } from 'react';\r\nimport {\r\n  CreateLocalTrackOptions,\r\n  ConnectOptions,\r\n  LocalAudioTrack,\r\n  LocalVideoTrack,\r\n  Room,\r\n  TwilioError,\r\n} from 'twilio-video';\r\nimport { Callback, ErrorCallback } from '../../types';\r\nimport { SelectedParticipantProvider } from './useSelectedParticipant/useSelectedParticipant';\r\n\r\nimport AttachVisibilityHandler from './AttachVisibilityHandler/AttachVisibilityHandler';\r\nimport useHandleRoomDisconnectionErrors from './useHandleRoomDisconnectionErrors/useHandleRoomDisconnectionErrors';\r\nimport useHandleOnDisconnect from './useHandleOnDisconnect/useHandleOnDisconnect';\r\nimport useHandleTrackPublicationFailed from './useHandleTrackPublicationFailed/useHandleTrackPublicationFailed';\r\nimport useLocalTracks from './useLocalTracks/useLocalTracks';\r\nimport useRoom from './useRoom/useRoom';\r\n\r\n/*\r\n *  The hooks used by the VideoProvider component are different than the hooks found in the 'hooks/' directory. The hooks\r\n *  in the 'hooks/' directory can be used anywhere in a video application, and they can be used any number of times.\r\n *  the hooks in the 'VideoProvider/' directory are intended to be used by the VideoProvider component only. Using these hooks\r\n *  elsewhere in the application may cause problems as these hooks should not be used more than once in an application.\r\n */\r\n\r\nexport interface IVideoContext {\r\n  room: Room;\r\n  localTracks: (LocalAudioTrack | LocalVideoTrack)[];\r\n  isConnecting: boolean;\r\n  connect: (token: string) => Promise<void>;\r\n  onError: ErrorCallback;\r\n  onDisconnect: Callback;\r\n  getLocalVideoTrack: (newOptions?: CreateLocalTrackOptions) => Promise<LocalVideoTrack>;\r\n  getLocalAudioTrack: (deviceId?: string) => Promise<LocalAudioTrack>;\r\n  isAcquiringLocalTracks: boolean;\r\n  removeLocalVideoTrack: () => void;\r\n}\r\n\r\nexport const VideoContext = createContext<IVideoContext>(null!);\r\n\r\ninterface VideoProviderProps {\r\n  options?: ConnectOptions;\r\n  onError: ErrorCallback;\r\n  onDisconnect?: Callback;\r\n  children: ReactNode;\r\n}\r\n\r\nexport function VideoProvider({ options, children, onError = () => {}, onDisconnect = () => {} }: VideoProviderProps) {\r\n  const onErrorCallback = (error: TwilioError) => {\r\n    console.log(`ERROR: ${error.message}`, error);\r\n    onError(error);\r\n  };\r\n\r\n  const {\r\n    localTracks,\r\n    getLocalVideoTrack,\r\n    getLocalAudioTrack,\r\n    isAcquiringLocalTracks,\r\n    removeLocalVideoTrack,\r\n  } = useLocalTracks();\r\n  const { room, isConnecting, connect } = useRoom(localTracks, onErrorCallback, options);\r\n\r\n  // Register onError and onDisconnect callback functions.\r\n  useHandleRoomDisconnectionErrors(room, onError);\r\n  useHandleTrackPublicationFailed(room, onError);\r\n  useHandleOnDisconnect(room, onDisconnect);\r\n\r\n  return (\r\n    <VideoContext.Provider\r\n      value={{\r\n        room,\r\n        localTracks,\r\n        isConnecting,\r\n        onError: onErrorCallback,\r\n        onDisconnect,\r\n        getLocalVideoTrack,\r\n        getLocalAudioTrack,\r\n        connect,\r\n        isAcquiringLocalTracks,\r\n        removeLocalVideoTrack,\r\n      }}\r\n    >\r\n      <SelectedParticipantProvider room={room}>{children}</SelectedParticipantProvider>\r\n      {/* \r\n        The AttachVisibilityHandler component is using the useLocalVideoToggle hook\r\n        which must be used within the VideoContext Provider.\r\n      */}\r\n      <AttachVisibilityHandler />\r\n    </VideoContext.Provider>\r\n  );\r\n}\r\n","import { DEFAULT_VIDEO_CONSTRAINTS } from '../../../constants';\r\nimport { useCallback, useEffect, useState } from 'react';\r\nimport Video, { LocalVideoTrack, LocalAudioTrack, CreateLocalTrackOptions } from 'twilio-video';\r\n\r\nexport default function useLocalTracks() {\r\n  const [audioTrack, setAudioTrack] = useState<LocalAudioTrack>();\r\n  const [videoTrack, setVideoTrack] = useState<LocalVideoTrack>();\r\n  const [isAcquiringLocalTracks, setIsAcquiringLocalTracks] = useState(false);\r\n\r\n  const getLocalAudioTrack = useCallback((deviceId?: string) => {\r\n    const options: CreateLocalTrackOptions = {};\r\n\r\n    if (deviceId) {\r\n      options.deviceId = { exact: deviceId };\r\n    }\r\n\r\n    return Video.createLocalAudioTrack(options).then(newTrack => {\r\n      setAudioTrack(newTrack);\r\n      return newTrack;\r\n    });\r\n  }, []);\r\n\r\n  const getLocalVideoTrack = useCallback((newOptions?: CreateLocalTrackOptions) => {\r\n    // In the DeviceSelector and FlipCameraButton components, a new video track is created,\r\n    // then the old track is unpublished and the new track is published. Unpublishing the old\r\n    // track and publishing the new track at the same time sometimes causes a conflict when the\r\n    // track name is 'camera', so here we append a timestamp to the track name to avoid the\r\n    // conflict.\r\n    const options: CreateLocalTrackOptions = {\r\n      ...(DEFAULT_VIDEO_CONSTRAINTS as {}),\r\n      name: `camera-${Date.now()}`,\r\n      ...newOptions,\r\n    };\r\n\r\n    return Video.createLocalVideoTrack(options).then(newTrack => {\r\n      setVideoTrack(newTrack);\r\n      return newTrack;\r\n    });\r\n  }, []);\r\n\r\n  const removeLocalVideoTrack = useCallback(() => {\r\n    if (videoTrack) {\r\n      videoTrack.stop();\r\n      setVideoTrack(undefined);\r\n    }\r\n  }, [videoTrack]);\r\n\r\n  useEffect(() => {\r\n    setIsAcquiringLocalTracks(true);\r\n    Video.createLocalTracks({\r\n      video: {\r\n        ...(DEFAULT_VIDEO_CONSTRAINTS as {}),\r\n        name: `camera-${Date.now()}`,\r\n      },\r\n      audio: true,\r\n    })\r\n      .then(tracks => {\r\n        const videoTrack = tracks.find(track => track.kind === 'video');\r\n        const audioTrack = tracks.find(track => track.kind === 'audio');\r\n        if (videoTrack) {\r\n          setVideoTrack(videoTrack as LocalVideoTrack);\r\n        }\r\n        if (audioTrack) {\r\n          setAudioTrack(audioTrack as LocalAudioTrack);\r\n        }\r\n      })\r\n      .finally(() => setIsAcquiringLocalTracks(false));\r\n  }, []);\r\n\r\n  const localTracks = [audioTrack, videoTrack].filter(track => track !== undefined) as (\r\n    | LocalAudioTrack\r\n    | LocalVideoTrack\r\n  )[];\r\n\r\n  return { localTracks, getLocalVideoTrack, getLocalAudioTrack, isAcquiringLocalTracks, removeLocalVideoTrack };\r\n}\r\n","import { Room, TwilioError } from 'twilio-video';\r\nimport { useEffect } from 'react';\r\n\r\nimport { Callback } from '../../../types';\r\n\r\nexport default function useHandleRoomDisconnectionErrors(room: Room, onError: Callback) {\r\n  useEffect(() => {\r\n    const onDisconnected = (room: Room, error: TwilioError) => {\r\n      if (error) {\r\n        onError(error);\r\n      }\r\n    };\r\n\r\n    room.on('disconnected', onDisconnected);\r\n    return () => {\r\n      room.off('disconnected', onDisconnected);\r\n    };\r\n  }, [room, onError]);\r\n}\r\n","import { Room } from 'twilio-video';\r\nimport { useEffect } from 'react';\r\n\r\nimport { Callback } from '../../../types';\r\n\r\nexport default function useHandleTrackPublicationFailed(room: Room, onError: Callback) {\r\n  const { localParticipant } = room;\r\n  useEffect(() => {\r\n    if (localParticipant) {\r\n      localParticipant.on('trackPublicationFailed', onError);\r\n      return () => {\r\n        localParticipant.off('trackPublicationFailed', onError);\r\n      };\r\n    }\r\n  }, [localParticipant, onError]);\r\n}\r\n","import { useEffect } from 'react';\r\nimport { Room } from 'twilio-video';\r\nimport { Callback } from '../../../types';\r\n\r\nexport default function useHandleOnDisconnect(room: Room, onDisconnect: Callback) {\r\n  useEffect(() => {\r\n    room.on('disconnected', onDisconnect);\r\n    return () => {\r\n      room.off('disconnected', onDisconnect);\r\n    };\r\n  }, [room, onDisconnect]);\r\n}\r\n","import { useContext } from 'react';\r\nimport { VideoContext } from '../../components/VideoProvider';\r\n\r\nexport default function useVideoContext() {\r\n  const context = useContext(VideoContext);\r\n  if (!context) {\r\n    throw new Error('useVideoContext must be used within a VideoProvider');\r\n  }\r\n  return context;\r\n}\r\n","import React from 'react';\r\nimport { createStyles, makeStyles, Theme } from '@material-ui/core/styles';\r\n\r\nimport CallEnd from '@material-ui/icons/CallEnd';\r\nimport Fab from '@material-ui/core/Fab';\r\nimport Tooltip from '@material-ui/core/Tooltip';\r\n\r\nimport useVideoContext from '../../../hooks/useVideoContext/useVideoContext';\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n  createStyles({\r\n    fab: {\r\n      margin: theme.spacing(1),\r\n      background: \"#cb3d3e\",\r\n      color: \"white\",\r\n      '&:hover': {\r\n        background: \"#d94a4b\"\r\n      },\r\n      '&:focus': {\r\n        outline: 'none'\r\n      }\r\n    },\r\n  })\r\n);\r\n\r\nexport default function EndCallButton() {\r\n  const classes = useStyles();\r\n  const { room } = useVideoContext();\r\n\r\n  return (\r\n    <Tooltip title={'End Call'} onClick={() => room.disconnect()} placement=\"top\" PopperProps={{ disablePortal: true }}>\r\n      <Fab className={classes.fab} color=\"primary\">\r\n        <CallEnd />\r\n      </Fab>\r\n    </Tooltip>\r\n  );\r\n}\r\n","import { useState, useEffect } from 'react';\r\nimport { LocalAudioTrack, LocalVideoTrack, RemoteAudioTrack, RemoteVideoTrack } from 'twilio-video';\r\n\r\ntype TrackType = LocalAudioTrack | LocalVideoTrack | RemoteAudioTrack | RemoteVideoTrack | undefined;\r\n\r\nexport default function useIsTrackEnabled(track: TrackType) {\r\n  const [isEnabled, setIsEnabled] = useState(track ? track.isEnabled : false);\r\n\r\n  useEffect(() => {\r\n    setIsEnabled(track ? track.isEnabled : false);\r\n\r\n    if (track) {\r\n      const setEnabled = () => setIsEnabled(true);\r\n      const setDisabled = () => setIsEnabled(false);\r\n      track.on('enabled', setEnabled);\r\n      track.on('disabled', setDisabled);\r\n      return () => {\r\n        track.off('enabled', setEnabled);\r\n        track.off('disabled', setDisabled);\r\n      };\r\n    }\r\n  }, [track]);\r\n\r\n  return isEnabled;\r\n}\r\n","import React from 'react';\r\nimport { createStyles, makeStyles, Theme } from '@material-ui/core/styles';\r\n\r\nimport Fab from '@material-ui/core/Fab';\r\nimport Mic from '@material-ui/icons/Mic';\r\nimport MicOff from '@material-ui/icons/MicOff';\r\nimport Tooltip from '@material-ui/core/Tooltip';\r\n\r\nimport useLocalAudioToggle from '../../../hooks/useLocalAudioToggle/useLocalAudioToggle';\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n  createStyles({\r\n    fab: {\r\n      margin: theme.spacing(1),\r\n      background: \"#3e4bb2\",\r\n      color: \"white\",\r\n      '&:hover': {\r\n        background: \"#323d95\"\r\n      },\r\n      '&:focus': {\r\n        outline: 'none'\r\n      }\r\n    },\r\n  })\r\n);\r\n\r\nexport default function ToggleAudioButton(props: { disabled?: boolean }) {\r\n  const classes = useStyles();\r\n  const [isAudioEnabled, toggleAudioEnabled] = useLocalAudioToggle();\r\n\r\n  return (\r\n    <Tooltip\r\n      title={isAudioEnabled ? 'Mute Audio' : 'Unmute Audio'}\r\n      placement=\"top\"\r\n      PopperProps={{ disablePortal: true }}\r\n    >\r\n      <Fab className={classes.fab} onClick={toggleAudioEnabled} disabled={props.disabled} data-cy-audio-toggle>\r\n        {isAudioEnabled ? <Mic /> : <MicOff />}\r\n      </Fab>\r\n    </Tooltip>\r\n  );\r\n}\r\n","import { LocalAudioTrack } from 'twilio-video';\r\nimport { useCallback } from 'react';\r\nimport useIsTrackEnabled from '../useIsTrackEnabled/useIsTrackEnabled';\r\nimport useVideoContext from '../useVideoContext/useVideoContext';\r\n\r\nexport default function useLocalAudioToggle() {\r\n  const { localTracks } = useVideoContext();\r\n  const audioTrack = localTracks.find(track => track.kind === 'audio') as LocalAudioTrack;\r\n  const isEnabled = useIsTrackEnabled(audioTrack);\r\n\r\n  const toggleAudioEnabled = useCallback(() => {\r\n    if (audioTrack) {\r\n      audioTrack.isEnabled ? audioTrack.disable() : audioTrack.enable();\r\n    }\r\n  }, [audioTrack]);\r\n\r\n  return [isEnabled, toggleAudioEnabled] as const;\r\n}\r\n","import React, { useCallback, useRef } from 'react';\r\nimport { createStyles, makeStyles, Theme } from '@material-ui/core/styles';\r\n\r\nimport Fab from '@material-ui/core/Fab';\r\nimport Tooltip from '@material-ui/core/Tooltip';\r\nimport Videocam from '@material-ui/icons/Videocam';\r\nimport VideocamOff from '@material-ui/icons/VideocamOff';\r\n\r\nimport useLocalVideoToggle from '../../../hooks/useLocalVideoToggle/useLocalVideoToggle';\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n  createStyles({\r\n    fab: {\r\n      margin: theme.spacing(1),\r\n      background: \"#3e4bb2\",\r\n      color: \"white\",\r\n      '&:hover': {\r\n        background: \"#323d95\"\r\n      },\r\n      '&:focus': {\r\n        outline: 'none'\r\n      }\r\n    },\r\n  })\r\n);\r\n\r\nexport default function ToggleVideoButton(props: { disabled?: boolean }) {\r\n  const classes = useStyles();\r\n  const [isVideoEnabled, toggleVideoEnabled] = useLocalVideoToggle();\r\n  const lastClickTimeRef = useRef(0);\r\n\r\n  const toggleVideo = useCallback(() => {\r\n    if (Date.now() - lastClickTimeRef.current > 200) {\r\n      lastClickTimeRef.current = Date.now();\r\n      toggleVideoEnabled();\r\n    }\r\n  }, [toggleVideoEnabled]);\r\n\r\n  return (\r\n    <Tooltip\r\n      title={isVideoEnabled ? 'Mute Video' : 'Unmute Video'}\r\n      placement=\"top\"\r\n      PopperProps={{ disablePortal: true }}\r\n    >\r\n      <Fab className={classes.fab} onClick={toggleVideo} disabled={props.disabled}>\r\n        {isVideoEnabled ? <Videocam /> : <VideocamOff />}\r\n      </Fab>\r\n    </Tooltip>\r\n  );\r\n}\r\n","import { useEffect, useState } from 'react';\r\nimport useVideoContext from '../useVideoContext/useVideoContext';\r\n\r\nimport { Participant, TrackPublication } from 'twilio-video';\r\n\r\n/*\r\n  Returns the participant that is sharing their screen (if any). This hook assumes that only one participant\r\n  can share their screen at a time.\r\n*/\r\nexport default function useScreenShareParticipant() {\r\n  const { room } = useVideoContext();\r\n  const [screenShareParticipant, setScreenShareParticipant] = useState<Participant>();\r\n\r\n  useEffect(() => {\r\n    if (room.state === 'connected') {\r\n      const updateScreenShareParticipant = () => {\r\n        setScreenShareParticipant(\r\n          Array.from<Participant>(room.participants.values())\r\n            // the screenshare participant could be the localParticipant\r\n            .concat(room.localParticipant)\r\n            .find((participant: Participant) =>\r\n              Array.from<TrackPublication>(participant.tracks.values()).find(track =>\r\n                track.trackName.includes('screen')\r\n              )\r\n            )\r\n        );\r\n      };\r\n      updateScreenShareParticipant();\r\n\r\n      room.on('trackPublished', updateScreenShareParticipant);\r\n      room.on('trackUnpublished', updateScreenShareParticipant);\r\n      room.on('participantDisconnected', updateScreenShareParticipant);\r\n\r\n      // the room object does not emit 'trackPublished' events for the localParticipant,\r\n      // so we need to listen for them here.\r\n      room.localParticipant.on('trackPublished', updateScreenShareParticipant);\r\n      room.localParticipant.on('trackUnpublished', updateScreenShareParticipant);\r\n      return () => {\r\n        room.off('trackPublished', updateScreenShareParticipant);\r\n        room.off('trackUnpublished', updateScreenShareParticipant);\r\n        room.off('participantDisconnected', updateScreenShareParticipant);\r\n\r\n        room.localParticipant.off('trackPublished', updateScreenShareParticipant);\r\n        room.localParticipant.off('trackUnpublished', updateScreenShareParticipant);\r\n      };\r\n    }\r\n  }, [room]);\r\n\r\n  return screenShareParticipant;\r\n}\r\n","import React from 'react';\r\nimport { createStyles, makeStyles, Theme } from '@material-ui/core/styles';\r\n\r\nimport Fab from '@material-ui/core/Fab';\r\nimport ScreenShare from '@material-ui/icons/ScreenShare';\r\nimport StopScreenShare from '@material-ui/icons/StopScreenShare';\r\nimport Tooltip from '@material-ui/core/Tooltip';\r\n\r\nimport useScreenShareToggle from '../../../hooks/useScreenShareToggle/useScreenShareToggle';\r\nimport useScreenShareParticipant from '../../../hooks/useScreenShareParticipant/useScreenShareParticipant';\r\nimport useVideoContext from '../../../hooks/useVideoContext/useVideoContext';\r\n\r\nexport const SCREEN_SHARE_TEXT = 'Share Screen';\r\nexport const STOP_SCREEN_SHARE_TEXT = 'Stop Sharing Screen';\r\nexport const SHARE_IN_PROGRESS_TEXT = 'Cannot share screen when another user is sharing';\r\nexport const SHARE_NOT_SUPPORTED_TEXT = 'Screen sharing is not supported with this browser';\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n  createStyles({\r\n    fab: {\r\n      margin: theme.spacing(1),\r\n      background: \"#3e4bb2\",\r\n      color: \"white\",\r\n      '&[disabled]': {\r\n        color: 'rgba(225, 225, 225, 0.8)',\r\n        backgroundColor: 'rgba(175, 175, 175, 0.6);',\r\n      },\r\n      '&:hover': {\r\n        background: \"#323d95\"\r\n      },\r\n      '&:focus': {\r\n        outline: 'none'\r\n      }\r\n    },\r\n  })\r\n);\r\n\r\nexport default function ToggleScreenShareButton(props: { disabled?: boolean }) {\r\n  const classes = useStyles();\r\n  const [isScreenShared, toggleScreenShare] = useScreenShareToggle();\r\n  const screenShareParticipant = useScreenShareParticipant();\r\n  const { room } = useVideoContext();\r\n  const disableScreenShareButton = screenShareParticipant && screenShareParticipant !== room.localParticipant;\r\n  const isScreenShareSupported = navigator.mediaDevices && navigator.mediaDevices.getDisplayMedia;\r\n  const isDisabled = props.disabled || disableScreenShareButton || !isScreenShareSupported;\r\n\r\n  let tooltipMessage = SCREEN_SHARE_TEXT;\r\n\r\n  if (isScreenShared) {\r\n    tooltipMessage = STOP_SCREEN_SHARE_TEXT;\r\n  }\r\n\r\n  if (disableScreenShareButton) {\r\n    tooltipMessage = SHARE_IN_PROGRESS_TEXT;\r\n  }\r\n\r\n  if (!isScreenShareSupported) {\r\n    tooltipMessage = SHARE_NOT_SUPPORTED_TEXT;\r\n  }\r\n\r\n  return (\r\n    <Tooltip\r\n      title={tooltipMessage}\r\n      placement=\"top\"\r\n      PopperProps={{ disablePortal: true }}\r\n      style={{ cursor: isDisabled ? 'not-allowed' : 'pointer' }}\r\n    >\r\n      <div>\r\n        {/* The div element is needed because a disabled button will not emit hover events and we want to display\r\n          a tooltip when screen sharing is disabled */}\r\n        <Fab className={classes.fab} onClick={toggleScreenShare} disabled={isDisabled}>\r\n          {isScreenShared ? <StopScreenShare /> : <ScreenShare />}\r\n        </Fab>\r\n      </div>\r\n    </Tooltip>\r\n  );\r\n}\r\n","import { useState, useCallback, useRef } from 'react';\r\nimport useVideoContext from '../useVideoContext/useVideoContext';\r\nimport { LogLevels, Track } from 'twilio-video';\r\n\r\ninterface MediaStreamTrackPublishOptions {\r\n  name?: string;\r\n  priority: Track.Priority;\r\n  logLevel: LogLevels;\r\n}\r\n\r\nexport default function useScreenShareToggle() {\r\n  const { room, onError } = useVideoContext();\r\n  const [isSharing, setIsSharing] = useState(false);\r\n  const stopScreenShareRef = useRef<() => void>(null!);\r\n\r\n  const shareScreen = useCallback(() => {\r\n    navigator.mediaDevices\r\n      .getDisplayMedia({\r\n        audio: false,\r\n        video: {\r\n          frameRate: 10,\r\n          height: 1080,\r\n          width: 1920,\r\n        },\r\n      })\r\n      .then(stream => {\r\n        const track = stream.getTracks()[0];\r\n\r\n        // All video tracks are published with 'low' priority. This works because the video\r\n        // track that is displayed in the 'MainParticipant' component will have it's priority\r\n        // set to 'high' via track.setPriority()\r\n        room.localParticipant\r\n          .publishTrack(track, {\r\n            name: 'screen', // Tracks can be named to easily find them later\r\n            priority: 'low', // Priority is set to high by the subscriber when the video track is rendered\r\n          } as MediaStreamTrackPublishOptions)\r\n          .then(trackPublication => {\r\n            stopScreenShareRef.current = () => {\r\n              room.localParticipant.unpublishTrack(track);\r\n              // TODO: remove this if the SDK is updated to emit this event\r\n              room.localParticipant.emit('trackUnpublished', trackPublication);\r\n              track.stop();\r\n              setIsSharing(false);\r\n            };\r\n\r\n            track.onended = stopScreenShareRef.current;\r\n            setIsSharing(true);\r\n          })\r\n          .catch(onError);\r\n      })\r\n      .catch(error => {\r\n        // Don't display an error if the user closes the screen share dialog\r\n        if (error.name !== 'AbortError' && error.name !== 'NotAllowedError') {\r\n          onError(error);\r\n        }\r\n      });\r\n  }, [room, onError]);\r\n\r\n  const toggleScreenShare = useCallback(() => {\r\n    !isSharing ? shareScreen() : stopScreenShareRef.current();\r\n  }, [isSharing, shareScreen, stopScreenShareRef]);\r\n\r\n  return [isSharing, toggleScreenShare] as const;\r\n}\r\n","import { useEffect, useState } from 'react';\r\nimport useVideoContext from '../useVideoContext/useVideoContext';\r\n\r\ntype RoomStateType = 'disconnected' | 'connected' | 'reconnecting';\r\n\r\nexport default function useRoomState() {\r\n  const { room } = useVideoContext();\r\n  const [state, setState] = useState<RoomStateType>('disconnected');\r\n\r\n  useEffect(() => {\r\n    const setRoomState = () => setState((room.state || 'disconnected') as RoomStateType);\r\n    setRoomState();\r\n    room\r\n      .on('disconnected', setRoomState)\r\n      .on('reconnected', setRoomState)\r\n      .on('reconnecting', setRoomState);\r\n    return () => {\r\n      room\r\n        .off('disconnected', setRoomState)\r\n        .off('reconnected', setRoomState)\r\n        .off('reconnecting', setRoomState);\r\n    };\r\n  }, [room]);\r\n\r\n  return state;\r\n}\r\n","import React from 'react';\r\nimport { createStyles, makeStyles, Theme } from '@material-ui/core/styles';\r\nimport clsx from 'clsx';\r\n\r\nimport EndCallButton from './EndCallButton/EndCallButton';\r\nimport ToggleAudioButton from './ToggleAudioButton/ToggleAudioButton';\r\nimport ToggleVideoButton from './ToggleVideoButton/ToggleVideoButton';\r\nimport ToggleScreenShareButton from './ToogleScreenShareButton/ToggleScreenShareButton';\r\n\r\nimport useIsUserActive from './useIsUserActive/useIsUserActive';\r\nimport useRoomState from '../../hooks/useRoomState/useRoomState';\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n  createStyles({\r\n    container: {\r\n      display: 'flex',\r\n      position: 'absolute',\r\n      right: '50%',\r\n      transform: 'translate(50%, 30px)',\r\n      bottom: '50px',\r\n      zIndex: 1,\r\n      transition: 'opacity 1.2s, transform 1.2s, visibility 0s 1.2s',\r\n      opacity: 0,\r\n      visibility: 'hidden',\r\n      maxWidth: 'min-content',\r\n      '&.showControls, &:hover': {\r\n        transition: 'opacity 0.6s, transform 0.6s, visibility 0s',\r\n        opacity: 1,\r\n        visibility: 'visible',\r\n        transform: 'translate(50%, 0px)',\r\n      },\r\n      [theme.breakpoints.down('xs')]: {\r\n        bottom: `${theme.sidebarMobileHeight + 3}px`,\r\n      },\r\n    },\r\n  })\r\n);\r\n\r\nexport default function Controls() {\r\n  const classes = useStyles();\r\n  const roomState = useRoomState();\r\n  const isReconnecting = roomState === 'reconnecting';\r\n  const isUserActive = useIsUserActive();\r\n  const showControls = isUserActive || roomState === 'disconnected';\r\n\r\n  return (\r\n    <div className={clsx(classes.container, { showControls })}>\r\n      <ToggleAudioButton disabled={isReconnecting} />\r\n      <ToggleVideoButton disabled={isReconnecting} />\r\n      {roomState !== 'disconnected' && (\r\n        <>\r\n          <ToggleScreenShareButton disabled={isReconnecting} />\r\n          <EndCallButton />\r\n        </>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n","import { useEffect, useRef, useState } from 'react';\r\nimport throttle from 'lodash.throttle';\r\n\r\nexport default function useIsUserActive() {\r\n  const [isUserActive, setIsUserActive] = useState(true);\r\n  const timeoutIDRef = useRef(0);\r\n\r\n  useEffect(() => {\r\n    const handleUserActivity = throttle(() => {\r\n      setIsUserActive(true);\r\n      clearTimeout(timeoutIDRef.current);\r\n      const timeoutID = window.setTimeout(() => setIsUserActive(false), 5000);\r\n      timeoutIDRef.current = timeoutID;\r\n    }, 500);\r\n\r\n    handleUserActivity();\r\n\r\n    window.addEventListener('mousemove', handleUserActivity);\r\n    window.addEventListener('click', handleUserActivity);\r\n    window.addEventListener('keydown', handleUserActivity);\r\n    return () => {\r\n      window.removeEventListener('mousemove', handleUserActivity);\r\n      window.removeEventListener('click', handleUserActivity);\r\n      window.removeEventListener('keydown', handleUserActivity);\r\n      clearTimeout(timeoutIDRef.current);\r\n    };\r\n  }, []);\r\n\r\n  return isUserActive;\r\n}\r\n","import { useState, useEffect } from 'react';\r\nimport { AudioTrack, VideoTrack } from 'twilio-video';\r\n\r\n/*\r\n * This hook allows components to reliably use the 'mediaStreamTrack' property of\r\n * an AudioTrack or a VideoTrack. Whenever 'localTrack.restart(...)' is called, it\r\n * will replace the mediaStreamTrack property of the localTrack, but the localTrack\r\n * object will stay the same. Therefore this hook is needed in order for components\r\n * to rerender in response to the mediaStreamTrack changing.\r\n */\r\nexport default function useMediaStreamTrack(track?: AudioTrack | VideoTrack) {\r\n  const [mediaStreamTrack, setMediaStreamTrack] = useState(track?.mediaStreamTrack);\r\n\r\n  useEffect(() => {\r\n    setMediaStreamTrack(track?.mediaStreamTrack);\r\n\r\n    if (track) {\r\n      const handleStarted = () => setMediaStreamTrack(track.mediaStreamTrack);\r\n      track.on('started', handleStarted);\r\n      return () => {\r\n        track.off('started', handleStarted);\r\n      };\r\n    }\r\n  }, [track]);\r\n\r\n  return mediaStreamTrack;\r\n}\r\n","import React, { useRef, useEffect } from 'react';\r\nimport { IVideoTrack } from '../../types';\r\nimport { styled } from '@material-ui/core/styles';\r\nimport { Track } from 'twilio-video';\r\nimport useMediaStreamTrack from '../../hooks/useMediaStreamTrack/useMediaStreamTrack';\r\n\r\nconst Video = styled('video')({\r\n  width: '100%',\r\n  maxHeight: '100%',\r\n  objectFit: 'contain',\r\n});\r\n\r\ninterface VideoTrackProps {\r\n  track: IVideoTrack;\r\n  isLocal?: boolean;\r\n  priority?: Track.Priority | null;\r\n}\r\n\r\nexport default function VideoTrack({ track, isLocal, priority }: VideoTrackProps) {\r\n  const ref = useRef<HTMLVideoElement>(null!);\r\n  const mediaStreamTrack = useMediaStreamTrack(track);\r\n\r\n  useEffect(() => {\r\n    const el = ref.current;\r\n    el.muted = true;\r\n    if (track.setPriority && priority) {\r\n      track.setPriority(priority);\r\n    }\r\n    track.attach(el);\r\n    return () => {\r\n      track.detach(el);\r\n      if (track.setPriority && priority) {\r\n        // Passing `null` to setPriority will set the track's priority to that which it was published with.\r\n        track.setPriority(null);\r\n      }\r\n    };\r\n  }, [track, priority]);\r\n\r\n  // The local video track is mirrored if it is not facing the environment.\r\n  const isFrontFacing = mediaStreamTrack?.getSettings().facingMode !== 'environment';\r\n  const style = isLocal && isFrontFacing ? { transform: 'rotateY(180deg)' } : {};\r\n\r\n  return <Video ref={ref} style={style} />;\r\n}\r\n","import React from 'react';\r\nimport { LocalVideoTrack } from 'twilio-video';\r\nimport VideoTrack from '../VideoTrack/VideoTrack';\r\nimport useVideoContext from '../../hooks/useVideoContext/useVideoContext';\r\n\r\nexport default function LocalVideoPreview() {\r\n  const { localTracks } = useVideoContext();\r\n\r\n  const videoTrack = localTracks.find(track => track.name.includes('camera')) as LocalVideoTrack;\r\n\r\n  return videoTrack ? <VideoTrack track={videoTrack} isLocal /> : null;\r\n}\r\n","import React from 'react';\r\n\r\nimport FullscreenIcon from '@material-ui/icons/Fullscreen';\r\nimport fscreen from 'fscreen';\r\nimport FullscreenExitIcon from '@material-ui/icons/FullscreenExit';\r\nimport IconButton from '@material-ui/core/IconButton';\r\n\r\nimport useFullScreenToggle from '../../../hooks/useFullScreenToggle/useFullScreenToggle';\r\n\r\nexport default function ToggleFullscreenButton() {\r\n  const [isFullScreen, toggleFullScreen] = useFullScreenToggle();\r\n\r\n  return fscreen.fullscreenEnabled ? (\r\n    <IconButton aria-label={`full screen`} onClick={toggleFullScreen}>\r\n      {isFullScreen ? <FullscreenExitIcon /> : <FullscreenIcon />}\r\n    </IconButton>\r\n  ) : null;\r\n}\r\n","import { useCallback, useState, useEffect } from 'react';\r\nimport fscreen from 'fscreen';\r\n\r\nexport default function useFullScreenToggle() {\r\n  const [isFullScreen, setIsFullScreen] = useState<Boolean>(!!fscreen.fullscreenElement);\r\n\r\n  useEffect(() => {\r\n    const onFullScreenChange = () => setIsFullScreen(!!fscreen.fullscreenElement);\r\n    fscreen.addEventListener('fullscreenchange', onFullScreenChange);\r\n    return () => {\r\n      fscreen.removeEventListener('fullscreenchange', onFullScreenChange);\r\n    };\r\n  }, []);\r\n\r\n  const toggleFullScreen = useCallback(() => {\r\n    isFullScreen ? fscreen.exitFullscreen() : fscreen.requestFullscreen(document.documentElement);\r\n  }, [isFullScreen]);\r\n\r\n  return [isFullScreen, toggleFullScreen] as const;\r\n}\r\n","import { isMobile } from '../../utils';\r\nimport { RenderDimensionValue } from './renderDimensions';\r\nimport { Track, VideoBandwidthProfileOptions } from 'twilio-video';\r\n\r\nexport interface Settings {\r\n  trackSwitchOffMode: VideoBandwidthProfileOptions['trackSwitchOffMode'];\r\n  dominantSpeakerPriority?: Track.Priority;\r\n  bandwidthProfileMode: VideoBandwidthProfileOptions['mode'];\r\n  maxTracks: string;\r\n  maxAudioBitrate: string;\r\n  renderDimensionLow?: RenderDimensionValue;\r\n  renderDimensionStandard?: RenderDimensionValue;\r\n  renderDimensionHigh?: RenderDimensionValue;\r\n}\r\n\r\ntype SettingsKeys = keyof Settings;\r\n\r\nexport interface SettingsAction {\r\n  name: SettingsKeys;\r\n  value: string;\r\n}\r\n\r\nexport const initialSettings: Settings = {\r\n  trackSwitchOffMode: undefined,\r\n  dominantSpeakerPriority: 'standard',\r\n  bandwidthProfileMode: 'collaboration',\r\n  maxTracks: isMobile ? '5' : '10',\r\n  maxAudioBitrate: '16000',\r\n  renderDimensionLow: 'low',\r\n  renderDimensionStandard: '960p',\r\n  renderDimensionHigh: 'wide1080p',\r\n};\r\n\r\n// This inputLabels object is used by ConnectionOptions.tsx. It is used to populate the id, name, and label props\r\n// of the various input elements. Using a typed object like this (instead of strings) eliminates the possibility\r\n// of there being a typo.\r\nexport const inputLabels = (() => {\r\n  const target: any = {};\r\n  for (const setting in initialSettings) {\r\n    target[setting] = setting as SettingsKeys;\r\n  }\r\n  return target as { [key in SettingsKeys]: string };\r\n})();\r\n\r\nexport function settingsReducer(state: Settings, action: SettingsAction) {\r\n  return {\r\n    ...state,\r\n    [action.name]: action.value === 'default' ? undefined : action.value,\r\n  };\r\n}\r\n","import React, { createContext, useContext, useReducer, useState } from 'react';\r\nimport { useDispatch, useSelector } from 'react-redux';\r\nimport { api, authApi, formData } from \"../../../utils\"\r\nimport { RoomType } from '../types';\r\nimport { TwilioError } from 'twilio-video';\r\nimport { settingsReducer, initialSettings, Settings, SettingsAction } from './settings/settingsReducer';\r\n\r\nconst API_ROOT_URL = \"http://ec2-18-219-119-244.us-east-2.compute.amazonaws.com:3000/api\"\r\n\r\nexport interface StateContextType {\r\n  error: TwilioError | null;\r\n  setError(error: TwilioError | null): void;\r\n  getToken(name: string, room: string, passcode?: string): Promise<string>;\r\n  user?: null | { displayName: undefined; photoURL: undefined; passcode?: string };\r\n  signIn?(passcode?: string): Promise<void>;\r\n  signOut?(): Promise<void>;\r\n  isAuthReady?: boolean;\r\n  isFetching: boolean;\r\n  activeSinkId: string;\r\n  setActiveSinkId(sinkId: string): void;\r\n  settings: Settings;\r\n  dispatchSetting: React.Dispatch<SettingsAction>;\r\n  roomType?: RoomType;\r\n}\r\n\r\n\r\nexport const StateContext = createContext<StateContextType>(null!);\r\n\r\n/*\r\n  The 'react-hooks/rules-of-hooks' linting rules prevent React Hooks fron being called\r\n  inside of if() statements. This is because hooks must always be called in the same order\r\n  every time a component is rendered. The 'react-hooks/rules-of-hooks' rule is disabled below\r\n  because the \"if (process.env.REACT_APP_SET_AUTH === 'firebase')\" statements are evaluated\r\n  at build time (not runtime). If the statement evaluates to false, then the code is not\r\n  included in the bundle that is produced (due to tree-shaking). Thus, in this instance, it\r\n  is ok to call hooks inside if() statements.\r\n*/\r\nexport default function AppStateProvider(props: React.PropsWithChildren<{}>) {\r\n  const [error, setError] = useState<TwilioError | null>(null);\r\n  const [isFetching, setIsFetching] = useState(false);\r\n  const [activeSinkId, setActiveSinkId] = useState('default');\r\n  const [settings, dispatchSetting] = useReducer(settingsReducer, initialSettings);\r\n\r\n  let contextValue = {\r\n    error,\r\n    setError,\r\n    isFetching,\r\n    activeSinkId,\r\n    setActiveSinkId,\r\n    settings,\r\n    dispatchSetting,\r\n  } as StateContextType;\r\n\r\n  contextValue = {\r\n    ...contextValue,\r\n    getToken: async (identity, roomName) => {\r\n      const headers = new window.Headers();\r\n      const endpoint = `${API_ROOT_URL}/workouts/join`;\r\n      const params = new window.URLSearchParams({ identity, roomName });\r\n\r\n      return authApi(`${endpoint}?${params}`, { headers }).then((res:any) => res.token);\r\n    },\r\n  };\r\n\r\n  const getToken: StateContextType['getToken'] = (name, room) => {\r\n    setIsFetching(true);\r\n    return contextValue\r\n      .getToken(name, room)\r\n      .then(res => {\r\n        setIsFetching(false);\r\n        return res;\r\n      })\r\n      .catch(err => {\r\n        setError(err.data.errors);\r\n        setIsFetching(false);\r\n        return Promise.reject(err);\r\n      });\r\n  };\r\n\r\n  return <StateContext.Provider value={{ ...contextValue, getToken }}>{props.children}</StateContext.Provider>;\r\n}\r\n\r\nexport function useAppState() {\r\n  const context = useContext(StateContext);\r\n  if (!context) {\r\n    throw new Error('useAppState must be used within the AppStateProvider');\r\n  }\r\n  return context;\r\n}\r\n","import React, { PropsWithChildren } from 'react';\r\nimport Button from '@material-ui/core/Button';\r\nimport Dialog from '@material-ui/core/Dialog';\r\nimport DialogActions from '@material-ui/core/DialogActions';\r\nimport DialogContent from '@material-ui/core/DialogContent';\r\nimport DialogContentText from '@material-ui/core/DialogContentText';\r\nimport DialogTitle from '@material-ui/core/DialogTitle';\r\n\r\nimport { version as appVersion } from '../../../../../../package.json';\r\nimport Video from 'twilio-video';\r\nimport { useAppState } from '../../../state';\r\n\r\ninterface AboutDialogProps {\r\n  open: boolean;\r\n  onClose(): void;\r\n}\r\n\r\nfunction AboutDialog({ open, onClose }: PropsWithChildren<AboutDialogProps>) {\r\n  const { roomType } = useAppState();\r\n  return (\r\n    <Dialog open={open} onClose={onClose} fullWidth={true} maxWidth=\"xs\">\r\n      <DialogTitle>About:</DialogTitle>\r\n      <DialogContent>\r\n        <DialogContentText>Browser supported: {String(Video.isSupported)}</DialogContentText>\r\n        <DialogContentText>SDK Version: {Video.version}</DialogContentText>\r\n        <DialogContentText>App Version: {appVersion}</DialogContentText>\r\n        <DialogContentText>Deployed Tag: {process.env.REACT_APP_GIT_TAG || 'N/A'}</DialogContentText>\r\n        <DialogContentText>Deployed Commit Hash: {process.env.REACT_APP_GIT_COMMIT || 'N/A'}</DialogContentText>\r\n        {roomType && <DialogContentText>Room Type: {roomType}</DialogContentText>}\r\n      </DialogContent>\r\n      <DialogActions>\r\n        <Button onClick={onClose} color=\"primary\" autoFocus>\r\n          OK\r\n        </Button>\r\n      </DialogActions>\r\n    </Dialog>\r\n  );\r\n}\r\n\r\nexport default AboutDialog;\r\n","import { VideoTrack } from 'twilio-video';\r\n\r\nexport type RenderDimensionValue =\r\n  | 'low'\r\n  | 'cif'\r\n  | 'vga'\r\n  | 'wvga'\r\n  | '540p'\r\n  | '720p'\r\n  | '960p'\r\n  | 'standard1080p'\r\n  | 'wide1080p'\r\n  | 'default';\r\n\r\nexport interface RenderDimension {\r\n  label: string;\r\n  value: RenderDimensionValue;\r\n  resolution?: VideoTrack.Dimensions;\r\n}\r\n\r\nexport const RenderDimensions: RenderDimension[] = [\r\n  {\r\n    label: 'Low (160 x 90)',\r\n    value: 'low',\r\n    resolution: { width: 160, height: 90 },\r\n  },\r\n  {\r\n    label: 'CIF (352 x 288)',\r\n    value: 'cif',\r\n    resolution: { width: 352, height: 288 },\r\n  },\r\n  {\r\n    label: 'VGA (640 x 480)',\r\n    value: 'vga',\r\n    resolution: { width: 640, height: 480 },\r\n  },\r\n  {\r\n    label: 'WVGA (800 x 480)',\r\n    value: 'wvga',\r\n    resolution: { width: 800, height: 480 },\r\n  },\r\n  {\r\n    label: 'HD 540P (960 x 540)',\r\n    value: '540p',\r\n    resolution: { width: 960, height: 540 },\r\n  },\r\n  {\r\n    label: 'HD 720P (1280 x 720)',\r\n    value: '720p',\r\n    resolution: { width: 1280, height: 720 },\r\n  },\r\n  {\r\n    label: 'HD 960P (1280 x 960)',\r\n    value: '960p',\r\n    resolution: { width: 1280, height: 960 },\r\n  },\r\n  {\r\n    label: 'HD Standard 1080P (1440 x 1080)',\r\n    value: 'standard1080p',\r\n    resolution: { width: 1440, height: 1080 },\r\n  },\r\n  {\r\n    label: 'HD Widescreen 1080P (1920 x 1080)',\r\n    value: 'wide1080p',\r\n    resolution: { width: 1920, height: 1080 },\r\n  },\r\n  {\r\n    label: 'Server Default',\r\n    value: 'default',\r\n    resolution: undefined,\r\n  },\r\n];\r\n\r\nexport function getResolution(value?: RenderDimensionValue) {\r\n  if (typeof value === 'undefined') {\r\n    return undefined;\r\n  }\r\n\r\n  return RenderDimensions.find(item => item.value === value)?.resolution;\r\n}\r\n","import React, { useCallback } from 'react';\r\nimport {\r\n  DialogContent,\r\n  FormControl,\r\n  Grid,\r\n  InputLabel,\r\n  MenuItem,\r\n  Select,\r\n  TextField,\r\n  Typography,\r\n} from '@material-ui/core';\r\nimport { makeStyles } from '@material-ui/core/styles';\r\nimport { inputLabels, Settings } from '../../../state/settings/settingsReducer';\r\nimport { RenderDimensions } from '../../../state/settings/renderDimensions';\r\nimport { useAppState } from '../../../state';\r\nimport useRoomState from '../../../hooks/useRoomState/useRoomState';\r\n\r\nconst useStyles = makeStyles({\r\n  formControl: {\r\n    display: 'block',\r\n    margin: '1.5em 0',\r\n    '&:first-child': {\r\n      margin: '0 0 1.5em 0',\r\n    },\r\n  },\r\n  label: {\r\n    width: '133%', // Labels have scale(0.75) applied to them, so this effectively makes the width 100%\r\n  },\r\n});\r\n\r\nconst withDefault = (val?: string) => (typeof val === 'undefined' ? 'default' : val);\r\n\r\nconst RenderDimensionItems = RenderDimensions.map(({ label, value }) => (\r\n  <MenuItem value={value} key={value}>\r\n    {label}\r\n  </MenuItem>\r\n));\r\n\r\nexport default function ConnectionOptions({ className, hidden }: { className?: string; hidden?: boolean }) {\r\n  const classes = useStyles();\r\n  const { settings, dispatchSetting } = useAppState();\r\n  const roomState = useRoomState();\r\n  const isDisabled = roomState !== 'disconnected';\r\n\r\n  const handleChange = useCallback(\r\n    (e: React.ChangeEvent<{ value: unknown; name?: string }>) => {\r\n      dispatchSetting({ name: e.target.name as keyof Settings, value: e.target.value as string });\r\n    },\r\n    [dispatchSetting]\r\n  );\r\n\r\n  const handleNumberChange = useCallback(\r\n    (e: React.ChangeEvent<{ value: unknown; name?: string }>) => {\r\n      if (!/[^\\d]/.test(e.target.value as string)) handleChange(e);\r\n    },\r\n    [handleChange]\r\n  );\r\n\r\n  return (\r\n    <DialogContent className={className} hidden={hidden}>\r\n      <Grid container spacing={2}>\r\n        <Grid item xs={12}>\r\n          <Typography variant=\"body2\">Bandwidth Profile Settings:</Typography>\r\n          <Typography hidden={!isDisabled} variant=\"body2\">\r\n            These settings cannot be changed when connected to a room.\r\n          </Typography>\r\n        </Grid>\r\n\r\n        <Grid item sm={6} xs={12}>\r\n          <FormControl className={classes.formControl}>\r\n            <InputLabel id={inputLabels.dominantSpeakerPriority}>Dominant Speaker Priority:</InputLabel>\r\n            <Select\r\n              fullWidth\r\n              disabled={isDisabled}\r\n              name={inputLabels.dominantSpeakerPriority}\r\n              label={inputLabels.dominantSpeakerPriority}\r\n              value={withDefault(settings.dominantSpeakerPriority)}\r\n              onChange={handleChange}\r\n            >\r\n              <MenuItem value=\"low\">Low</MenuItem>\r\n              <MenuItem value=\"standard\">Standard</MenuItem>\r\n              <MenuItem value=\"high\">High</MenuItem>\r\n              <MenuItem value=\"default\">Server Default</MenuItem>\r\n            </Select>\r\n          </FormControl>\r\n\r\n          <FormControl className={classes.formControl}>\r\n            <InputLabel id={inputLabels.trackSwitchOffMode}>Track Switch Off Mode:</InputLabel>\r\n            <Select\r\n              fullWidth\r\n              disabled={isDisabled}\r\n              name={inputLabels.trackSwitchOffMode}\r\n              label={inputLabels.trackSwitchOffMode}\r\n              value={withDefault(settings.trackSwitchOffMode)}\r\n              onChange={handleChange}\r\n            >\r\n              <MenuItem value=\"predicted\">Predicted</MenuItem>\r\n              <MenuItem value=\"detected\">Detected</MenuItem>\r\n              <MenuItem value=\"disabled\">Disabled</MenuItem>\r\n              <MenuItem value=\"default\">Server Default</MenuItem>\r\n            </Select>\r\n          </FormControl>\r\n\r\n          <FormControl className={classes.formControl}>\r\n            <InputLabel id={inputLabels.bandwidthProfileMode}>Mode:</InputLabel>\r\n            <Select\r\n              fullWidth\r\n              disabled={isDisabled}\r\n              name={inputLabels.bandwidthProfileMode}\r\n              label={inputLabels.bandwidthProfileMode}\r\n              value={withDefault(settings.bandwidthProfileMode)}\r\n              onChange={handleChange}\r\n            >\r\n              <MenuItem value=\"grid\">Grid</MenuItem>\r\n              <MenuItem value=\"collaboration\">Collaboration</MenuItem>\r\n              <MenuItem value=\"presentation\">Presentation</MenuItem>\r\n              <MenuItem value=\"default\">Server Default</MenuItem>\r\n            </Select>\r\n          </FormControl>\r\n\r\n          <FormControl className={classes.formControl}>\r\n            <TextField\r\n              disabled={isDisabled}\r\n              fullWidth\r\n              id={inputLabels.maxTracks}\r\n              label=\"Max Tracks\"\r\n              placeholder=\"Leave blank for no limit\"\r\n              name={inputLabels.maxTracks}\r\n              value={withDefault(settings.maxTracks)}\r\n              onChange={handleNumberChange}\r\n            />\r\n          </FormControl>\r\n\r\n          <FormControl className={classes.formControl}>\r\n            <TextField\r\n              disabled={isDisabled}\r\n              fullWidth\r\n              id={inputLabels.maxAudioBitrate}\r\n              label=\"Max Audio Bitrate\"\r\n              placeholder=\"Leave blank for no limit\"\r\n              name={inputLabels.maxAudioBitrate}\r\n              value={withDefault(settings.maxAudioBitrate)}\r\n              onChange={handleNumberChange}\r\n            />\r\n          </FormControl>\r\n        </Grid>\r\n        <Grid item sm={6} xs={12}>\r\n          <FormControl fullWidth className={classes.formControl}>\r\n            <InputLabel id={inputLabels.renderDimensionLow} className={classes.label}>\r\n              Render Dimension (Low Priority):\r\n            </InputLabel>\r\n            <Select\r\n              fullWidth\r\n              disabled={isDisabled}\r\n              name={inputLabels.renderDimensionLow}\r\n              label={inputLabels.renderDimensionLow}\r\n              value={withDefault(settings.renderDimensionLow)}\r\n              onChange={handleChange}\r\n            >\r\n              {RenderDimensionItems}\r\n            </Select>\r\n          </FormControl>\r\n\r\n          <FormControl fullWidth className={classes.formControl}>\r\n            <InputLabel id={inputLabels.renderDimensionStandard} className={classes.label}>\r\n              Render Dimension (Standard Priority):\r\n            </InputLabel>\r\n            <Select\r\n              fullWidth\r\n              disabled={isDisabled}\r\n              name={inputLabels.renderDimensionStandard}\r\n              label={inputLabels.renderDimensionStandard}\r\n              value={withDefault(settings.renderDimensionStandard)}\r\n              onChange={handleChange}\r\n            >\r\n              {RenderDimensionItems}\r\n            </Select>\r\n          </FormControl>\r\n\r\n          <FormControl fullWidth className={classes.formControl}>\r\n            <InputLabel id={inputLabels.renderDimensionHigh} className={classes.label}>\r\n              Render Dimension (High Priority):\r\n            </InputLabel>\r\n            <Select\r\n              fullWidth\r\n              disabled={isDisabled}\r\n              name={inputLabels.renderDimensionHigh}\r\n              label={inputLabels.renderDimensionHigh}\r\n              value={withDefault(settings.renderDimensionHigh)}\r\n              onChange={handleChange}\r\n            >\r\n              {RenderDimensionItems}\r\n            </Select>\r\n          </FormControl>\r\n        </Grid>\r\n      </Grid>\r\n    </DialogContent>\r\n  );\r\n}\r\n","import React, { useEffect, useRef, useState } from 'react';\r\nimport { AudioTrack, LocalAudioTrack, RemoteAudioTrack } from 'twilio-video';\r\nimport { interval } from 'd3-timer';\r\nimport MicOff from '@material-ui/icons/MicOff';\r\nimport useIsTrackEnabled from '../../hooks/useIsTrackEnabled/useIsTrackEnabled';\r\nimport useMediaStreamTrack from '../../hooks/useMediaStreamTrack/useMediaStreamTrack';\r\n\r\nlet clipId = 0;\r\nconst getUniqueClipId = () => clipId++;\r\n\r\n// @ts-ignore\r\nconst AudioContext = window.AudioContext || window.webkitAudioContext;\r\nlet audioContext: AudioContext;\r\n\r\nexport function initializeAnalyser(stream: MediaStream) {\r\n  audioContext = audioContext || new AudioContext();\r\n  const audioSource = audioContext.createMediaStreamSource(stream);\r\n\r\n  const analyser = audioContext.createAnalyser();\r\n  analyser.smoothingTimeConstant = 0.4;\r\n  analyser.fftSize = 512;\r\n\r\n  audioSource.connect(analyser);\r\n  return analyser;\r\n}\r\n\r\nfunction AudioLevelIndicator({\r\n  size,\r\n  audioTrack,\r\n  background,\r\n}: {\r\n  size?: number;\r\n  audioTrack?: AudioTrack;\r\n  background?: string;\r\n}) {\r\n  const SIZE = size || 24;\r\n  const SVGRectRef = useRef<SVGRectElement>(null);\r\n  const [analyser, setAnalyser] = useState<AnalyserNode>();\r\n  const isTrackEnabled = useIsTrackEnabled(audioTrack as LocalAudioTrack | RemoteAudioTrack);\r\n  const mediaStreamTrack = useMediaStreamTrack(audioTrack);\r\n\r\n  useEffect(() => {\r\n    if (audioTrack && mediaStreamTrack && isTrackEnabled) {\r\n      // Here we create a new MediaStream from a clone of the mediaStreamTrack.\r\n      // A clone is created to allow multiple instances of this component for a single\r\n      // AudioTrack on iOS Safari.\r\n      let newMediaStream = new MediaStream([mediaStreamTrack.clone()]);\r\n\r\n      // Here we listen for the 'stopped' event on the audioTrack. When the audioTrack is stopped,\r\n      // we stop the cloned track that is stored in 'newMediaStream'. It is important that we stop\r\n      // all tracks when they are not in use. Browsers like Firefox don't let you create a new stream\r\n      // from a new audio device while the active audio device still has active tracks.\r\n      const stopAllMediaStreamTracks = () => newMediaStream.getTracks().forEach(track => track.stop());\r\n      audioTrack.on('stopped', stopAllMediaStreamTracks);\r\n\r\n      const reinitializeAnalyser = () => {\r\n        stopAllMediaStreamTracks();\r\n        newMediaStream = new MediaStream([mediaStreamTrack.clone()]);\r\n        setAnalyser(initializeAnalyser(newMediaStream));\r\n      };\r\n\r\n      setAnalyser(initializeAnalyser(newMediaStream));\r\n\r\n      // Here we reinitialize the AnalyserNode on focus to avoid an issue in Safari\r\n      // where the analysers stop functioning when the user switches to a new tab\r\n      // and switches back to the app.\r\n      window.addEventListener('focus', reinitializeAnalyser);\r\n\r\n      return () => {\r\n        stopAllMediaStreamTracks();\r\n        window.removeEventListener('focus', reinitializeAnalyser);\r\n        audioTrack.off('stopped', stopAllMediaStreamTracks);\r\n      };\r\n    }\r\n  }, [isTrackEnabled, mediaStreamTrack, audioTrack]);\r\n\r\n  useEffect(() => {\r\n    const SVGClipElement = SVGRectRef.current;\r\n\r\n    if (isTrackEnabled && SVGClipElement && analyser) {\r\n      const sampleArray = new Uint8Array(analyser.frequencyBinCount);\r\n\r\n      const timer = interval(() => {\r\n        analyser.getByteFrequencyData(sampleArray);\r\n        let values = 0;\r\n\r\n        const length = sampleArray.length;\r\n        for (let i = 0; i < length; i++) {\r\n          values += sampleArray[i];\r\n        }\r\n\r\n        const volume = Math.min(21, Math.max(0, Math.log10(values / length / 3) * 14));\r\n\r\n        SVGClipElement?.setAttribute('y', String(21 - volume));\r\n      }, 50);\r\n\r\n      return () => {\r\n        SVGClipElement.setAttribute('y', '21');\r\n        timer.stop();\r\n      };\r\n    }\r\n  }, [isTrackEnabled, analyser]);\r\n\r\n  // Each instance of this component will need a unique HTML ID\r\n  const clipPathId = `audio-level-clip-${getUniqueClipId()}`;\r\n\r\n  return isTrackEnabled ? (\r\n    <svg focusable=\"false\" viewBox=\"0 0 24 24\" aria-hidden=\"true\" height={`${SIZE}px`} width={`${SIZE}px`}>\r\n      <defs>\r\n        <clipPath id={clipPathId}>\r\n          <rect ref={SVGRectRef} x=\"0\" y=\"21\" width=\"24\" height=\"24\" />\r\n        </clipPath>\r\n      </defs>\r\n      <path\r\n        fill={background || 'rgba(255, 255, 255, 0.1)'}\r\n        d=\"M12 14c1.66 0 2.99-1.34 2.99-3L15 5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3zm5.3-3c0 3-2.54 5.1-5.3 5.1S6.7 14 6.7 11H5c0 3.41 2.72 6.23 6 6.72V21h2v-3.28c3.28-.48 6-3.3 6-6.72h-1.7z\"\r\n      ></path>\r\n      <path\r\n        fill=\"#0c0\"\r\n        clipPath={`url(#${clipPathId})`}\r\n        d=\"M12 14c1.66 0 2.99-1.34 2.99-3L15 5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3zm5.3-3c0 3-2.54 5.1-5.3 5.1S6.7 14 6.7 11H5c0 3.41 2.72 6.23 6 6.72V21h2v-3.28c3.28-.48 6-3.3 6-6.72h-1.7z\"\r\n      ></path>\r\n    </svg>\r\n  ) : (\r\n    <MicOff\r\n      height={`${SIZE}px`}\r\n      width={`${SIZE}px`}\r\n      style={{ width: 'initial', height: 'initial' }}\r\n      data-cy-audio-mute-icon\r\n    />\r\n  );\r\n}\r\n\r\nexport default React.memo(AudioLevelIndicator);\r\n","import React from 'react';\r\nimport { LocalAudioTrack } from 'twilio-video';\r\nimport useVideoContext from '../../../../hooks/useVideoContext/useVideoContext';\r\nimport AudioLevelIndicator from '../../../AudioLevelIndicator/AudioLevelIndicator';\r\n\r\nexport default function LocalAudioLevelIndicator() {\r\n  const { localTracks } = useVideoContext();\r\n  const audioTrack = localTracks.find(track => track.kind === 'audio') as LocalAudioTrack;\r\n\r\n  return <AudioLevelIndicator size={30} audioTrack={audioTrack} />;\r\n}\r\n","import { useState, useEffect } from 'react';\r\nimport { ensureMediaPermissions } from '../../../../utils';\r\n\r\nexport function useDevices() {\r\n  const [devices, setDevices] = useState<MediaDeviceInfo[]>([]);\r\n\r\n  useEffect(() => {\r\n    const getDevices = () =>\r\n      ensureMediaPermissions().then(() =>\r\n        navigator.mediaDevices.enumerateDevices().then(devices => setDevices(devices))\r\n      );\r\n    navigator.mediaDevices.addEventListener('devicechange', getDevices);\r\n    getDevices();\r\n\r\n    return () => {\r\n      navigator.mediaDevices.removeEventListener('devicechange', getDevices);\r\n    };\r\n  }, []);\r\n\r\n  return devices;\r\n}\r\n\r\nexport function useAudioInputDevices() {\r\n  const devices = useDevices();\r\n  return devices.filter(device => device.kind === 'audioinput');\r\n}\r\n\r\nexport function useVideoInputDevices() {\r\n  const devices = useDevices();\r\n  return devices.filter(device => device.kind === 'videoinput');\r\n}\r\n\r\nexport function useAudioOutputDevices() {\r\n  const devices = useDevices();\r\n  return devices.filter(device => device.kind === 'audiooutput');\r\n}\r\n","import React from 'react';\r\nimport { FormControl, MenuItem, Typography, Select } from '@material-ui/core';\r\nimport LocalAudioLevelIndicator from '../LocalAudioLevelIndicator/LocalAudioLevelIndicator';\r\nimport { makeStyles } from '@material-ui/core/styles';\r\nimport { useAudioInputDevices } from '../deviceHooks/deviceHooks';\r\nimport useMediaStreamTrack from '../../../../hooks/useMediaStreamTrack/useMediaStreamTrack';\r\nimport useVideoContext from '../../../../hooks/useVideoContext/useVideoContext';\r\n\r\nconst useStyles = makeStyles({\r\n  container: {\r\n    display: 'flex',\r\n    alignItems: 'flex-end',\r\n    justifyContent: 'space-between',\r\n  },\r\n});\r\n\r\nexport default function AudioInputList() {\r\n  const classes = useStyles();\r\n  const audioInputDevices = useAudioInputDevices();\r\n  const { localTracks } = useVideoContext();\r\n\r\n  const localAudioTrack = localTracks.find(track => track.kind === 'audio');\r\n  const mediaStreamTrack = useMediaStreamTrack(localAudioTrack);\r\n  const localAudioInputDeviceId = mediaStreamTrack?.getSettings().deviceId;\r\n\r\n  function replaceTrack(newDeviceId: string) {\r\n    localAudioTrack?.restart({ deviceId: { exact: newDeviceId } });\r\n  }\r\n\r\n  return (\r\n    <div className={classes.container}>\r\n      <div className=\"inputSelect\">\r\n        {audioInputDevices.length > 1 ? (\r\n          <FormControl fullWidth>\r\n            <Typography variant=\"h6\">Audio Input:</Typography>\r\n            <Select onChange={e => replaceTrack(e.target.value as string)} value={localAudioInputDeviceId || ''}>\r\n              {audioInputDevices.map(device => (\r\n                <MenuItem value={device.deviceId} key={device.deviceId}>\r\n                  {device.label}\r\n                </MenuItem>\r\n              ))}\r\n            </Select>\r\n          </FormControl>\r\n        ) : (\r\n          <>\r\n            <Typography variant=\"h6\">Audio Input:</Typography>\r\n            <Typography>{localAudioTrack?.mediaStreamTrack.label || 'No Local Audio'}</Typography>\r\n          </>\r\n        )}\r\n      </div>\r\n      <LocalAudioLevelIndicator />\r\n    </div>\r\n  );\r\n}\r\n","import React from 'react';\r\nimport { FormControl, MenuItem, Typography, Select } from '@material-ui/core';\r\nimport { useAppState } from '../../../../state';\r\nimport { useAudioOutputDevices } from '../deviceHooks/deviceHooks';\r\n\r\nexport default function AudioOutputList() {\r\n  const audioOutputDevices = useAudioOutputDevices();\r\n  const { activeSinkId, setActiveSinkId } = useAppState();\r\n  const activeOutputLabel = audioOutputDevices.find(device => device.deviceId === activeSinkId)?.label;\r\n\r\n  return (\r\n    <div className=\"inputSelect\">\r\n      {audioOutputDevices.length > 1 ? (\r\n        <FormControl fullWidth>\r\n          <Typography variant=\"h6\">Audio Output:</Typography>\r\n          <Select onChange={e => setActiveSinkId(e.target.value as string)} value={activeSinkId}>\r\n            {audioOutputDevices.map(device => (\r\n              <MenuItem value={device.deviceId} key={device.deviceId}>\r\n                {device.label}\r\n              </MenuItem>\r\n            ))}\r\n          </Select>\r\n        </FormControl>\r\n      ) : (\r\n        <>\r\n          <Typography variant=\"h6\">Audio Output:</Typography>\r\n          <Typography>{activeOutputLabel || 'System Default Audio Output'}</Typography>\r\n        </>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n","import React from 'react';\r\nimport { DEFAULT_VIDEO_CONSTRAINTS } from '../../../../constants';\r\nimport { FormControl, MenuItem, Typography, Select } from '@material-ui/core';\r\nimport { LocalVideoTrack } from 'twilio-video';\r\nimport { makeStyles } from '@material-ui/core/styles';\r\nimport VideoTrack from '../../../VideoTrack/VideoTrack';\r\nimport useMediaStreamTrack from '../../../../hooks/useMediaStreamTrack/useMediaStreamTrack';\r\nimport useVideoContext from '../../../../hooks/useVideoContext/useVideoContext';\r\nimport { useVideoInputDevices } from '../deviceHooks/deviceHooks';\r\n\r\nconst useStyles = makeStyles({\r\n  preview: {\r\n    width: '150px',\r\n    margin: '0.5em 0',\r\n  },\r\n});\r\n\r\nexport default function VideoInputList() {\r\n  const classes = useStyles();\r\n  const videoInputDevices = useVideoInputDevices();\r\n  const { localTracks } = useVideoContext();\r\n\r\n  const localVideoTrack = localTracks.find(track => track.kind === 'video') as LocalVideoTrack;\r\n  const mediaStreamTrack = useMediaStreamTrack(localVideoTrack);\r\n  const localVideoInputDeviceId = mediaStreamTrack?.getSettings().deviceId;\r\n\r\n  function replaceTrack(newDeviceId: string) {\r\n    localVideoTrack.restart({\r\n      ...(DEFAULT_VIDEO_CONSTRAINTS as {}),\r\n      deviceId: { exact: newDeviceId },\r\n    });\r\n  }\r\n\r\n  return (\r\n    <div>\r\n      {videoInputDevices.length > 1 ? (\r\n        <FormControl>\r\n          <Typography variant=\"h6\">Video Input:</Typography>\r\n          <Select onChange={e => replaceTrack(e.target.value as string)} value={localVideoInputDeviceId || ''}>\r\n            {videoInputDevices.map(device => (\r\n              <MenuItem value={device.deviceId} key={device.deviceId}>\r\n                {device.label}\r\n              </MenuItem>\r\n            ))}\r\n          </Select>\r\n        </FormControl>\r\n      ) : (\r\n        <>\r\n          <Typography variant=\"h6\">Video Input:</Typography>\r\n          <Typography>{localVideoTrack?.mediaStreamTrack.label || 'No Local Video'}</Typography>\r\n        </>\r\n      )}\r\n      {localVideoTrack && (\r\n        <div className={classes.preview}>\r\n          <VideoTrack isLocal track={localVideoTrack} />\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n","import React from 'react';\r\n\r\nimport AudioInputList from './AudioInputList/AudioInputList';\r\nimport AudioOutputList from './AudioOutputList/AudioOutputList';\r\nimport { DialogContent } from '@material-ui/core';\r\nimport { makeStyles } from '@material-ui/core/styles';\r\nimport VideoInputList from './VideoInputList/VideoInputList';\r\n\r\nconst useStyles = makeStyles({\r\n  listSection: {\r\n    margin: '2em 0',\r\n    '&:first-child': {\r\n      margin: '1em 0 2em 0',\r\n    },\r\n  },\r\n});\r\n\r\nexport function DeviceSelector({ className, hidden }: { className?: string; hidden?: boolean }) {\r\n  const classes = useStyles();\r\n\r\n  return (\r\n    <DialogContent className={className} hidden={hidden}>\r\n      <div className={classes.listSection}>\r\n        <AudioInputList />\r\n      </div>\r\n      <div className={classes.listSection}>\r\n        <AudioOutputList />\r\n      </div>\r\n      <div className={classes.listSection}>\r\n        <VideoInputList />\r\n      </div>\r\n    </DialogContent>\r\n  );\r\n}\r\n","import React, { useState } from 'react';\r\nimport { Button, Dialog, DialogActions, Tab, Tabs, Theme } from '@material-ui/core';\r\nimport { createStyles, makeStyles } from '@material-ui/core/styles';\r\nimport ConnectionOptions from '../ConnectionOptions/ConnectionOptions';\r\nimport { DeviceSelector } from '../DeviceSelector/DeviceSelector';\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n  createStyles({\r\n    container: {\r\n      width: '525px',\r\n      minHeight: '400px',\r\n      [theme.breakpoints.down('xs')]: {\r\n        width: 'calc(100vw - 32px)',\r\n      },\r\n      '& .inputSelect': {\r\n        width: 'calc(100% - 35px)',\r\n      },\r\n    },\r\n    button: {\r\n      float: 'right',\r\n    },\r\n    paper: {\r\n      [theme.breakpoints.down('xs')]: {\r\n        margin: '16px',\r\n      },\r\n    },\r\n  })\r\n);\r\n\r\nexport default function SettingsDialog({ open, onClose }: { open: boolean; onClose: () => void }) {\r\n  const classes = useStyles();\r\n  const [selectedTab, setSelectedTab] = useState(0);\r\n\r\n  const handleChange = (_: React.ChangeEvent<{}>, newValue: number) => {\r\n    setSelectedTab(newValue);\r\n  };\r\n\r\n  return (\r\n    <Dialog open={open} onClose={onClose} classes={{ paper: classes.paper }}>\r\n      <Tabs value={selectedTab} onChange={handleChange}>\r\n        <Tab label=\"Devices\" />\r\n        <Tab label=\"Settings\" />\r\n      </Tabs>\r\n      <DeviceSelector className={classes.container} hidden={selectedTab !== 0} />\r\n      <ConnectionOptions className={classes.container} hidden={selectedTab !== 1} />\r\n      <DialogActions>\r\n        <Button className={classes.button} onClick={onClose}>\r\n          Done\r\n        </Button>\r\n      </DialogActions>\r\n    </Dialog>\r\n  );\r\n}\r\n","import React, { useState, useRef, useCallback } from 'react';\r\nimport AboutDialog from '../AboutDialog/AboutDialog';\r\nimport IconButton from '@material-ui/core/IconButton';\r\nimport MenuContainer from '@material-ui/core/Menu';\r\nimport MenuItem from '@material-ui/core/MenuItem';\r\nimport MoreIcon from '@material-ui/icons/MoreVert';\r\nimport SettingsDialog from '../SettingsDialog/SettingsDialog';\r\n\r\nimport { useAppState } from '../../../state';\r\nimport useVideoContext from '../../../hooks/useVideoContext/useVideoContext';\r\n\r\nexport default function Menu() {\r\n  const { user } = useAppState();\r\n  const { room, localTracks } = useVideoContext();\r\n\r\n  const [aboutOpen, setAboutOpen] = useState(false);\r\n  const [menuOpen, setMenuOpen] = useState(false);\r\n  const [settingsOpen, setSettingsOpen] = useState(false);\r\n\r\n  const anchorRef = useRef<HTMLDivElement>(null);\r\n\r\n  return (\r\n    <div ref={anchorRef}>\r\n      <a onClick={() => setSettingsOpen(true)}>Settings</a>\r\n      <AboutDialog\r\n        open={aboutOpen}\r\n        onClose={() => {\r\n          setAboutOpen(false);\r\n          setMenuOpen(false);\r\n        }}\r\n      />\r\n      <SettingsDialog\r\n        open={settingsOpen}\r\n        onClose={() => {\r\n          setSettingsOpen(false);\r\n          setMenuOpen(false);\r\n        }}\r\n      />\r\n    </div>\r\n  );\r\n}\r\n","import React, { useCallback, useEffect, useState } from 'react';\r\nimport { DEFAULT_VIDEO_CONSTRAINTS } from '../../../constants';\r\nimport FlipCameraIosIcon from '@material-ui/icons/FlipCameraIos';\r\nimport { IconButton } from '@material-ui/core';\r\nimport { LocalVideoTrack } from 'twilio-video';\r\nimport useMediaStreamTrack from '../../../hooks/useMediaStreamTrack/useMediaStreamTrack';\r\nimport useVideoContext from '../../../hooks/useVideoContext/useVideoContext';\r\n\r\nexport default function FlipCameraButton() {\r\n  const { localTracks } = useVideoContext();\r\n  const [supportsFacingMode, setSupportsFacingMode] = useState<Boolean | null>(null);\r\n  const videoTrack = localTracks.find(track => track.name.includes('camera')) as LocalVideoTrack;\r\n  const mediaStreamTrack = useMediaStreamTrack(videoTrack);\r\n\r\n  useEffect(() => {\r\n    // The 'supportsFacingMode' variable determines if this component is rendered\r\n    // If 'facingMode' exists, we will set supportsFacingMode to true.\r\n    // However, if facingMode is ever undefined again (when the user unpublishes video), we\r\n    // won't set 'supportsFacingMode' to false. This prevents the icon from briefly\r\n    // disappearing when the user switches their front/rear camera.\r\n    const currentFacingMode = mediaStreamTrack?.getSettings().facingMode;\r\n    if (currentFacingMode && supportsFacingMode === null) {\r\n      setSupportsFacingMode(true);\r\n    }\r\n  }, [mediaStreamTrack, supportsFacingMode]);\r\n\r\n  const toggleFacingMode = useCallback(() => {\r\n    const newFacingMode = mediaStreamTrack?.getSettings().facingMode === 'user' ? 'environment' : 'user';\r\n    videoTrack.restart({\r\n      ...(DEFAULT_VIDEO_CONSTRAINTS as {}),\r\n      facingMode: newFacingMode,\r\n    });\r\n  }, [mediaStreamTrack, videoTrack]);\r\n\r\n  return supportsFacingMode ? (\r\n    <IconButton onClick={toggleFacingMode} disabled={!videoTrack}>\r\n      <FlipCameraIosIcon />\r\n    </IconButton>\r\n  ) : null;\r\n}\r\n","import React, { ChangeEvent, FormEvent, useState, useEffect } from 'react';\r\nimport { useDispatch, useSelector } from 'react-redux';\r\nimport { createStyles, makeStyles, Theme } from '@material-ui/core/styles';\r\n\r\nimport AppBar from '@material-ui/core/AppBar';\r\nimport Button from '@material-ui/core/Button';\r\nimport CircularProgress from '@material-ui/core/CircularProgress';\r\nimport TextField from '@material-ui/core/TextField';\r\nimport ToggleFullscreenButton from './ToggleFullScreenButton/ToggleFullScreenButton';\r\nimport Toolbar from '@material-ui/core/Toolbar';\r\nimport Menu from './Menu/Menu';\r\n\r\nimport { useAppState } from '../../state';\r\nimport { useParams } from 'react-router-dom';\r\nimport useRoomState from '../../hooks/useRoomState/useRoomState';\r\nimport useVideoContext from '../../hooks/useVideoContext/useVideoContext';\r\nimport { Typography } from '@material-ui/core';\r\nimport FlipCameraButton from './FlipCameraButton/FlipCameraButton';\r\nimport LocalAudioLevelIndicator from './DeviceSelector/LocalAudioLevelIndicator/LocalAudioLevelIndicator';\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n  createStyles({\r\n    container: {\r\n      backgroundColor: theme.palette.background.default,\r\n    },\r\n    toolbar: {\r\n      [theme.breakpoints.down('xs')]: {\r\n        padding: 0,\r\n      },\r\n    },\r\n    rightButtonContainer: {\r\n      display: 'flex',\r\n      alignItems: 'center',\r\n      marginLeft: 'auto',\r\n    },\r\n    form: {\r\n      display: 'flex',\r\n      flexWrap: 'wrap',\r\n      alignItems: 'center',\r\n      [theme.breakpoints.up('md')]: {\r\n        marginLeft: '2.2em',\r\n      },\r\n    },\r\n    textField: {\r\n      marginLeft: theme.spacing(1),\r\n      marginRight: theme.spacing(1),\r\n      maxWidth: 200,\r\n    },\r\n    loadingSpinner: {\r\n      marginLeft: '1em',\r\n    },\r\n    displayName: {\r\n      margin: '1.1em 0.6em',\r\n      minWidth: '200px',\r\n      fontWeight: 600,\r\n    },\r\n    joinButton: {\r\n      margin: '1em',\r\n    },\r\n  })\r\n);\r\n\r\n\r\ninterface RootState {\r\n  auth: any\r\n}\r\n\r\nexport default function MenuBar() {\r\n  const classes = useStyles();\r\n  const { URLRoomName } = useParams();\r\n  const profile = useSelector((state: RootState) => state.auth.profile)\r\n  const parmas = useParams();\r\n  // const profile = useSelector((state) => state.auth.profile)\r\n  const { user, getToken, isFetching } = useAppState();\r\n  const { isConnecting, connect, isAcquiringLocalTracks } = useVideoContext();\r\n  const roomState = useRoomState();\r\n\r\n  const [name, setName] = useState<string>(user?.displayName || '');\r\n  const [roomName, setRoomName] = useState<string>('');\r\n\r\n  useEffect(() => {\r\n    if (URLRoomName) {\r\n      setRoomName(URLRoomName);\r\n      getToken(profile.userId, URLRoomName).then(token => connect(token));\r\n    }\r\n  }, [URLRoomName]);\r\n\r\n  const handleNameChange = (event: ChangeEvent<HTMLInputElement>) => {\r\n    setName(event.target.value);\r\n  };\r\n\r\n  const handleRoomNameChange = (event: ChangeEvent<HTMLInputElement>) => {\r\n    setRoomName(event.target.value);\r\n  };\r\n\r\n  const handleSubmit = (event: FormEvent<HTMLFormElement>) => {\r\n    event.preventDefault();\r\n    // If this app is deployed as a twilio function, don't change the URL because routing isn't supported.\r\n    if (!window.location.origin.includes('twil.io')) {\r\n      window.history.replaceState(null, '', window.encodeURI(`/room/${roomName}${window.location.search || ''}`));\r\n    }\r\n    getToken(name, roomName).then(token => connect(token));\r\n  };\r\n\r\n\r\n  return (\r\n    <AppBar className={classes.container} position=\"static\">\r\n      <Toolbar className={classes.toolbar}>\r\n        {roomState === 'connected' && (\r\n          <h3>{roomName}</h3>\r\n        )}\r\n        <div className={classes.rightButtonContainer}>\r\n          <FlipCameraButton />\r\n          <LocalAudioLevelIndicator />\r\n          <ToggleFullscreenButton />\r\n          <Menu />\r\n        </div>\r\n      </Toolbar>\r\n    </AppBar>\r\n  );\r\n}\r\n","import React from 'react';\r\nimport { makeStyles } from '@material-ui/core/styles';\r\n\r\nimport InfoIcon from '@material-ui/icons/Info';\r\nimport Snackbar from '@material-ui/core/Snackbar';\r\nimport { SnackbarContent } from '@material-ui/core';\r\n\r\nimport useRoomState from '../../hooks/useRoomState/useRoomState';\r\n\r\nconst useStyles = makeStyles({\r\n  snackbar: {\r\n    backgroundColor: '#6db1ff',\r\n  },\r\n  message: {\r\n    display: 'flex',\r\n    alignItems: 'center',\r\n  },\r\n  icon: {\r\n    marginRight: '0.8em',\r\n  },\r\n});\r\n\r\nexport default function ReconnectingNotification() {\r\n  const classes = useStyles();\r\n  const roomState = useRoomState();\r\n\r\n  return (\r\n    <Snackbar anchorOrigin={{ vertical: 'bottom', horizontal: 'right' }} open={roomState === 'reconnecting'}>\r\n      <SnackbarContent\r\n        className={classes.snackbar}\r\n        message={\r\n          <span className={classes.message}>\r\n            <InfoIcon className={classes.icon} />\r\n            Reconnecting&hellip;\r\n          </span>\r\n        }\r\n      />\r\n    </Snackbar>\r\n  );\r\n}\r\n","import React from 'react';\r\nimport { styled } from '@material-ui/core';\r\n\r\nimport ErrorOutlineIcon from '@material-ui/icons/ErrorOutline';\r\n\r\nconst BandwidthWarningContainer = styled('div')({\r\n  position: 'absolute',\r\n  zIndex: 1,\r\n  width: '100%',\r\n  display: 'flex',\r\n  flexDirection: 'column',\r\n  justifyContent: 'center',\r\n  alignItems: 'center',\r\n});\r\n\r\nconst Warning = styled('h3')({\r\n  textAlign: 'center',\r\n  margin: '0.6em 0',\r\n});\r\n\r\nexport default function BandwidthWarning() {\r\n  return (\r\n    <BandwidthWarningContainer>\r\n      <div>\r\n        <ErrorOutlineIcon fontSize=\"large\" />\r\n      </div>\r\n      <Warning>Insufficient Bandwidth</Warning>\r\n    </BandwidthWarningContainer>\r\n  );\r\n}\r\n","import React from 'react';\r\nimport { styled } from '@material-ui/core/styles';\r\n\r\nconst Container = styled('div')({\r\n  display: 'flex',\r\n  alignItems: 'flex-end',\r\n  '& div': {\r\n    width: '2px',\r\n    border: '1px solid black',\r\n    boxSizing: 'content-box',\r\n    '&:not(:last-child)': {\r\n      borderRight: 'none',\r\n    },\r\n  },\r\n});\r\n\r\nconst STEP = 3;\r\n\r\nexport default function NetworkQualityLevel({ qualityLevel }: { qualityLevel: number | null }) {\r\n  if (qualityLevel === null) return null;\r\n  return (\r\n    <Container>\r\n      {[0, 1, 2, 3, 4].map(level => (\r\n        <div\r\n          key={level}\r\n          style={{\r\n            height: `${STEP * (level + 1)}px`,\r\n            background: qualityLevel > level ? '#0c0' : '#040',\r\n          }}\r\n        />\r\n      ))}\r\n    </Container>\r\n  );\r\n}\r\n","import React from 'react';\r\nimport clsx from 'clsx';\r\nimport { makeStyles } from '@material-ui/core/styles';\r\nimport { Participant } from 'twilio-video';\r\nimport useParticipantIsReconnecting from '../../../hooks/useParticipantIsReconnecting/useParticipantIsReconnecting';\r\nimport { Tooltip } from '@material-ui/core';\r\n\r\nconst useStyles = makeStyles({\r\n  indicator: {\r\n    width: '10px',\r\n    height: '10px',\r\n    borderRadius: '100%',\r\n    background: '#0c0',\r\n    display: 'inline-block',\r\n    marginRight: '3px',\r\n  },\r\n  isReconnecting: {\r\n    background: '#ffb100',\r\n  },\r\n});\r\n\r\nexport default function ParticipantConnectionIndicator({ participant }: { participant: Participant }) {\r\n  const isReconnecting = useParticipantIsReconnecting(participant);\r\n  const classes = useStyles();\r\n  return (\r\n    <Tooltip title={isReconnecting ? 'Participant is reconnecting' : 'Participant is connected'}>\r\n      <span className={clsx(classes.indicator, { [classes.isReconnecting]: isReconnecting })}></span>\r\n    </Tooltip>\r\n  );\r\n}\r\n","import { useEffect, useState } from 'react';\r\nimport { Participant } from 'twilio-video';\r\n\r\nexport default function useParticipantIsReconnecting(participant: Participant) {\r\n  const [isReconnecting, setIsReconnecting] = useState(false);\r\n\r\n  useEffect(() => {\r\n    const handleReconnecting = () => setIsReconnecting(true);\r\n    const handleReconnected = () => setIsReconnecting(false);\r\n\r\n    participant.on('reconnecting', handleReconnecting);\r\n    participant.on('reconnected', handleReconnected);\r\n    return () => {\r\n      participant.off('reconnecting', handleReconnecting);\r\n      participant.off('reconnected', handleReconnected);\r\n    };\r\n  }, [participant]);\r\n\r\n  return isReconnecting;\r\n}\r\n","import React from 'react';\r\nimport { Pin } from '@primer/octicons-react';\r\nimport Tooltip from '@material-ui/core/Tooltip';\r\nimport SvgIcon from '@material-ui/core/SvgIcon';\r\n\r\nexport default function PinIcon() {\r\n  return (\r\n    <Tooltip title=\"Participant is pinned. Click to un-pin.\" placement=\"top\">\r\n      <SvgIcon style={{ float: 'right', fontSize: '29px' }}>\r\n        <Pin />\r\n      </SvgIcon>\r\n    </Tooltip>\r\n  );\r\n}\r\n","import { useEffect, useState } from 'react';\r\nimport { LocalTrackPublication, Participant, RemoteTrackPublication } from 'twilio-video';\r\n\r\ntype TrackPublication = LocalTrackPublication | RemoteTrackPublication;\r\n\r\nexport default function usePublications(participant: Participant) {\r\n  const [publications, setPublications] = useState<TrackPublication[]>([]);\r\n\r\n  useEffect(() => {\r\n    // Reset the publications when the 'participant' variable changes.\r\n    setPublications(Array.from(participant.tracks.values()) as TrackPublication[]);\r\n\r\n    const publicationAdded = (publication: TrackPublication) =>\r\n      setPublications(prevPublications => [...prevPublications, publication]);\r\n    const publicationRemoved = (publication: TrackPublication) =>\r\n      setPublications(prevPublications => prevPublications.filter(p => p !== publication));\r\n\r\n    participant.on('trackPublished', publicationAdded);\r\n    participant.on('trackUnpublished', publicationRemoved);\r\n    return () => {\r\n      participant.off('trackPublished', publicationAdded);\r\n      participant.off('trackUnpublished', publicationRemoved);\r\n    };\r\n  }, [participant]);\r\n\r\n  return publications;\r\n}\r\n","import { useState, useEffect } from 'react';\r\nimport { LocalVideoTrack, RemoteVideoTrack } from 'twilio-video';\r\n\r\ntype TrackType = RemoteVideoTrack | LocalVideoTrack | undefined | null;\r\n\r\n// The 'switchedOff' event is emitted when there is not enough bandwidth to support\r\n// a track. See: https://www.twilio.com/docs/video/tutorials/using-bandwidth-profile-api#understanding-track-switch-offs\r\n\r\nexport default function useIsTrackSwitchedOff(track: TrackType) {\r\n  const [isSwitchedOff, setIsSwitchedOff] = useState(track && track.isSwitchedOff);\r\n\r\n  useEffect(() => {\r\n    // Reset the value if the 'track' variable changes\r\n    setIsSwitchedOff(track && track.isSwitchedOff);\r\n\r\n    if (track) {\r\n      const handleSwitchedOff = () => setIsSwitchedOff(true);\r\n      const handleSwitchedOn = () => setIsSwitchedOff(false);\r\n      track.on('switchedOff', handleSwitchedOff);\r\n      track.on('switchedOn', handleSwitchedOn);\r\n      return () => {\r\n        track.off('switchedOff', handleSwitchedOff);\r\n        track.off('switchedOn', handleSwitchedOn);\r\n      };\r\n    }\r\n  }, [track]);\r\n\r\n  return !!isSwitchedOff;\r\n}\r\n","import { useEffect, useState } from 'react';\r\nimport { LocalTrackPublication, RemoteTrackPublication } from 'twilio-video';\r\n\r\nexport default function useTrack(publication: LocalTrackPublication | RemoteTrackPublication | undefined) {\r\n  const [track, setTrack] = useState(publication && publication.track);\r\n\r\n  useEffect(() => {\r\n    // Reset the track when the 'publication' variable changes.\r\n    setTrack(publication && publication.track);\r\n\r\n    if (publication) {\r\n      const removeTrack = () => setTrack(null);\r\n\r\n      publication.on('subscribed', setTrack);\r\n      publication.on('unsubscribed', removeTrack);\r\n      return () => {\r\n        publication.off('subscribed', setTrack);\r\n        publication.off('unsubscribed', removeTrack);\r\n      };\r\n    }\r\n  }, [publication]);\r\n\r\n  return track;\r\n}\r\n","import React from 'react';\r\nimport clsx from 'clsx';\r\nimport { createStyles, makeStyles, Theme } from '@material-ui/core/styles';\r\nimport { LocalAudioTrack, LocalVideoTrack, Participant, RemoteAudioTrack, RemoteVideoTrack } from 'twilio-video';\r\n\r\nimport AudioLevelIndicator from '../AudioLevelIndicator/AudioLevelIndicator';\r\nimport BandwidthWarning from '../BandwidthWarning/BandwidthWarning';\r\nimport NetworkQualityLevel from '../NewtorkQualityLevel/NetworkQualityLevel';\r\nimport ParticipantConnectionIndicator from './ParticipantConnectionIndicator/ParticipantConnectionIndicator';\r\nimport PinIcon from './PinIcon/PinIcon';\r\nimport ScreenShare from '@material-ui/icons/ScreenShare';\r\nimport VideocamOff from '@material-ui/icons/VideocamOff';\r\n\r\nimport useParticipantNetworkQualityLevel from '../../hooks/useParticipantNetworkQualityLevel/useParticipantNetworkQualityLevel';\r\nimport usePublications from '../../hooks/usePublications/usePublications';\r\nimport useIsTrackSwitchedOff from '../../hooks/useIsTrackSwitchedOff/useIsTrackSwitchedOff';\r\nimport useTrack from '../../hooks/useTrack/useTrack';\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n  createStyles({\r\n    container: {\r\n      position: 'relative',\r\n      display: 'flex',\r\n      alignItems: 'center',\r\n      height: `${(theme.sidebarWidth * 9) / 16}px`,\r\n      overflow: 'hidden',\r\n      cursor: 'pointer',\r\n      '& video': {\r\n        filter: 'none',\r\n      },\r\n      '& svg': {\r\n        stroke: 'black',\r\n        strokeWidth: '0.8px',\r\n      },\r\n      [theme.breakpoints.down('xs')]: {\r\n        height: theme.sidebarMobileHeight,\r\n        width: `${(theme.sidebarMobileHeight * 16) / 9}px`,\r\n        marginRight: '3px',\r\n        fontSize: '10px',\r\n      },\r\n    },\r\n    isVideoSwitchedOff: {\r\n      '& video': {\r\n        filter: 'blur(4px) grayscale(1) brightness(0.5)',\r\n      },\r\n    },\r\n    infoContainer: {\r\n      position: 'absolute',\r\n      zIndex: 1,\r\n      display: 'flex',\r\n      flexDirection: 'column',\r\n      justifyContent: 'space-between',\r\n      height: '100%',\r\n      padding: '0.4em',\r\n      width: '100%',\r\n      background: 'transparent',\r\n    },\r\n    hideVideo: {\r\n      background: 'black',\r\n    },\r\n    identity: {\r\n      background: 'rgba(0, 0, 0, 0.7)',\r\n      padding: '0.1em 0.3em',\r\n      margin: 0,\r\n      display: 'flex',\r\n      alignItems: 'center',\r\n    },\r\n    infoRow: {\r\n      display: 'flex',\r\n      justifyContent: 'space-between',\r\n    },\r\n  })\r\n);\r\n\r\ninterface ParticipantInfoProps {\r\n  participant: Participant;\r\n  children: React.ReactNode;\r\n  onClick: () => void;\r\n  isSelected: boolean;\r\n}\r\n\r\nexport default function ParticipantInfo({ participant, onClick, isSelected, children }: ParticipantInfoProps) {\r\n  const publications = usePublications(participant);\r\n\r\n  const audioPublication = publications.find(p => p.kind === 'audio');\r\n  const videoPublication = publications.find(p => p.trackName.includes('camera'));\r\n\r\n  const networkQualityLevel = useParticipantNetworkQualityLevel(participant);\r\n  const isVideoEnabled = Boolean(videoPublication);\r\n  const isScreenShareEnabled = publications.find(p => p.trackName.includes('screen'));\r\n\r\n  const videoTrack = useTrack(videoPublication);\r\n  const isVideoSwitchedOff = useIsTrackSwitchedOff(videoTrack as LocalVideoTrack | RemoteVideoTrack);\r\n\r\n  const audioTrack = useTrack(audioPublication) as LocalAudioTrack | RemoteAudioTrack;\r\n\r\n  const classes = useStyles();\r\n\r\n  return (\r\n    <div\r\n      className={clsx(classes.container, {\r\n        [classes.isVideoSwitchedOff]: isVideoSwitchedOff,\r\n      })}\r\n      onClick={onClick}\r\n      data-cy-participant={participant.identity}\r\n    >\r\n      <div className={clsx(classes.infoContainer, { [classes.hideVideo]: !isVideoEnabled })}>\r\n        <div className={classes.infoRow}>\r\n          <h4 className={classes.identity}>\r\n            <ParticipantConnectionIndicator participant={participant} />\r\n            {participant.identity}\r\n          </h4>\r\n          <NetworkQualityLevel qualityLevel={networkQualityLevel} />\r\n        </div>\r\n        <div>\r\n          <AudioLevelIndicator audioTrack={audioTrack} background=\"white\" />\r\n          {!isVideoEnabled && <VideocamOff />}\r\n          {isScreenShareEnabled && <ScreenShare />}\r\n          {isSelected && <PinIcon />}\r\n        </div>\r\n      </div>\r\n      {isVideoSwitchedOff && <BandwidthWarning />}\r\n      {children}\r\n    </div>\r\n  );\r\n}\r\n","import { useEffect, useState } from 'react';\r\nimport { Participant } from 'twilio-video';\r\n\r\nexport default function useParticipantNetworkQualityLevel(participant: Participant) {\r\n  const [networkQualityLevel, setNetworkQualityLevel] = useState(participant.networkQualityLevel);\r\n\r\n  useEffect(() => {\r\n    const handleNewtorkQualityLevelChange = (newNetworkQualityLevel: number) =>\r\n      setNetworkQualityLevel(newNetworkQualityLevel);\r\n\r\n    setNetworkQualityLevel(participant.networkQualityLevel);\r\n    participant.on('networkQualityLevelChanged', handleNewtorkQualityLevelChange);\r\n    return () => {\r\n      participant.off('networkQualityLevelChanged', handleNewtorkQualityLevelChange);\r\n    };\r\n  }, [participant]);\r\n\r\n  return networkQualityLevel;\r\n}\r\n","import { useEffect, useRef } from 'react';\r\nimport { AudioTrack as IAudioTrack } from 'twilio-video';\r\nimport { useAppState } from '../../state';\r\n\r\ninterface AudioTrackProps {\r\n  track: IAudioTrack;\r\n}\r\n\r\nexport default function AudioTrack({ track }: AudioTrackProps) {\r\n  const { activeSinkId } = useAppState();\r\n  const audioEl = useRef<HTMLAudioElement>();\r\n\r\n  useEffect(() => {\r\n    audioEl.current = track.attach();\r\n    audioEl.current.setAttribute('data-cy-audio-track-name', track.name);\r\n    document.body.appendChild(audioEl.current);\r\n    return () => track.detach().forEach(el => el.remove());\r\n  }, [track]);\r\n\r\n  useEffect(() => {\r\n    audioEl.current?.setSinkId?.(activeSinkId);\r\n  }, [activeSinkId]);\r\n\r\n  return null;\r\n}\r\n","import React from 'react';\r\nimport useTrack from '../../hooks/useTrack/useTrack';\r\nimport AudioTrack from '../AudioTrack/AudioTrack';\r\nimport VideoTrack from '../VideoTrack/VideoTrack';\r\n\r\nimport { IVideoTrack } from '../../types';\r\nimport {\r\n  AudioTrack as IAudioTrack,\r\n  LocalTrackPublication,\r\n  Participant,\r\n  RemoteTrackPublication,\r\n  Track,\r\n} from 'twilio-video';\r\n\r\ninterface PublicationProps {\r\n  publication: LocalTrackPublication | RemoteTrackPublication;\r\n  participant: Participant;\r\n  isLocal: boolean;\r\n  disableAudio?: boolean;\r\n  videoPriority?: Track.Priority | null;\r\n}\r\n\r\nexport default function Publication({ publication, isLocal, disableAudio, videoPriority }: PublicationProps) {\r\n  const track = useTrack(publication);\r\n\r\n  if (!track) return null;\r\n\r\n  switch (track.kind) {\r\n    case 'video':\r\n      return (\r\n        <VideoTrack\r\n          track={track as IVideoTrack}\r\n          priority={videoPriority}\r\n          isLocal={track.name.includes('camera') && isLocal}\r\n        />\r\n      );\r\n    case 'audio':\r\n      return disableAudio ? null : <AudioTrack track={track as IAudioTrack} />;\r\n    default:\r\n      return null;\r\n  }\r\n}\r\n","import React from 'react';\r\nimport { Participant, Track } from 'twilio-video';\r\nimport Publication from '../Publication/Publication';\r\nimport usePublications from '../../hooks/usePublications/usePublications';\r\nimport useVideoContext from '../../hooks/useVideoContext/useVideoContext';\r\n\r\ninterface ParticipantTracksProps {\r\n  participant: Participant;\r\n  disableAudio?: boolean;\r\n  enableScreenShare?: boolean;\r\n  videoPriority?: Track.Priority | null;\r\n}\r\n\r\n/*\r\n *  The object model for the Room object (found here: https://www.twilio.com/docs/video/migrating-1x-2x#object-model) shows\r\n *  that Participant objects have TrackPublications, and TrackPublication objects have Tracks.\r\n *\r\n *  The React components in this application follow the same pattern. This ParticipantTracks component renders Publications,\r\n *  and the Publication component renders Tracks.\r\n */\r\n\r\nexport default function ParticipantTracks({\r\n  participant,\r\n  disableAudio,\r\n  enableScreenShare,\r\n  videoPriority,\r\n}: ParticipantTracksProps) {\r\n  const { room } = useVideoContext();\r\n  const publications = usePublications(participant);\r\n  const isLocal = participant === room.localParticipant;\r\n\r\n  let filteredPublications;\r\n\r\n  if (enableScreenShare && publications.some(p => p.trackName.includes('screen'))) {\r\n    filteredPublications = publications.filter(p => !p.trackName.includes('camera'));\r\n  } else {\r\n    filteredPublications = publications.filter(p => !p.trackName.includes('screen'));\r\n  }\r\n\r\n  return (\r\n    <>\r\n      {filteredPublications.map(publication => (\r\n        <Publication\r\n          key={publication.kind}\r\n          publication={publication}\r\n          participant={participant}\r\n          isLocal={isLocal}\r\n          disableAudio={disableAudio}\r\n          videoPriority={videoPriority}\r\n        />\r\n      ))}\r\n    </>\r\n  );\r\n}\r\n","import React from 'react';\r\nimport ParticipantInfo from '../ParticipantInfo/ParticipantInfo';\r\nimport ParticipantTracks from '../ParticipantTracks/ParticipantTracks';\r\nimport { Participant as IParticipant } from 'twilio-video';\r\n\r\ninterface ParticipantProps {\r\n  participant: IParticipant;\r\n  disableAudio?: boolean;\r\n  enableScreenShare?: boolean;\r\n  onClick: () => void;\r\n  isSelected: boolean;\r\n}\r\n\r\nexport default function Participant({\r\n  participant,\r\n  disableAudio,\r\n  enableScreenShare,\r\n  onClick,\r\n  isSelected,\r\n}: ParticipantProps) {\r\n  return (\r\n    <ParticipantInfo participant={participant} onClick={onClick} isSelected={isSelected}>\r\n      <ParticipantTracks participant={participant} disableAudio={disableAudio} enableScreenShare={enableScreenShare} />\r\n    </ParticipantInfo>\r\n  );\r\n}\r\n","import { useEffect, useState } from 'react';\r\nimport useVideoContext from '../useVideoContext/useVideoContext';\r\nimport { RemoteParticipant } from 'twilio-video';\r\n\r\nexport default function useDominantSpeaker() {\r\n  const { room } = useVideoContext();\r\n  const [dominantSpeaker, setDominantSpeaker] = useState(room.dominantSpeaker);\r\n\r\n  useEffect(() => {\r\n    // Sometimes, the 'dominantSpeakerChanged' event can emit 'null', which means that\r\n    // there is no dominant speaker. If we change the main participant when 'null' is\r\n    // emitted, the effect can be jarring to the user. Here we ignore any 'null' values\r\n    // and continue to display the previous dominant speaker as the main participant.\r\n    const handleDominantSpeakerChanged = (newDominantSpeaker: RemoteParticipant) => {\r\n      if (newDominantSpeaker !== null) {\r\n        setDominantSpeaker(newDominantSpeaker);\r\n      }\r\n    };\r\n\r\n    // Since 'null' values are ignored, we will need to listen for the 'participantDisconnected'\r\n    // event, so we can set the dominantSpeaker to 'null' when they disconnect.\r\n    const handleParticipantDisconnected = (participant: RemoteParticipant) => {\r\n      setDominantSpeaker(prevDominantSpeaker => {\r\n        return prevDominantSpeaker === participant ? null : prevDominantSpeaker;\r\n      });\r\n    };\r\n\r\n    room.on('dominantSpeakerChanged', handleDominantSpeakerChanged);\r\n    room.on('participantDisconnected', handleParticipantDisconnected);\r\n    return () => {\r\n      room.off('dominantSpeakerChanged', handleDominantSpeakerChanged);\r\n      room.off('participantDisconnected', handleParticipantDisconnected);\r\n    };\r\n  }, [room]);\r\n\r\n  return dominantSpeaker;\r\n}\r\n","import { useEffect, useState } from 'react';\r\nimport { RemoteParticipant } from 'twilio-video';\r\nimport useDominantSpeaker from '../useDominantSpeaker/useDominantSpeaker';\r\nimport useVideoContext from '../useVideoContext/useVideoContext';\r\n\r\nexport default function useParticipants() {\r\n  const { room } = useVideoContext();\r\n  const dominantSpeaker = useDominantSpeaker();\r\n  const [participants, setParticipants] = useState(Array.from(room.participants.values()));\r\n\r\n  // When the dominant speaker changes, they are moved to the front of the participants array.\r\n  // This means that the most recent dominant speakers will always be near the top of the\r\n  // ParticipantStrip component.\r\n  useEffect(() => {\r\n    if (dominantSpeaker) {\r\n      setParticipants(prevParticipants => [\r\n        dominantSpeaker,\r\n        ...prevParticipants.filter(participant => participant !== dominantSpeaker),\r\n      ]);\r\n    }\r\n  }, [dominantSpeaker]);\r\n\r\n  useEffect(() => {\r\n    const participantConnected = (participant: RemoteParticipant) =>\r\n      setParticipants(prevParticipants => [...prevParticipants, participant]);\r\n    const participantDisconnected = (participant: RemoteParticipant) =>\r\n      setParticipants(prevParticipants => prevParticipants.filter(p => p !== participant));\r\n    room.on('participantConnected', participantConnected);\r\n    room.on('participantDisconnected', participantDisconnected);\r\n    return () => {\r\n      room.off('participantConnected', participantConnected);\r\n      room.off('participantDisconnected', participantDisconnected);\r\n    };\r\n  }, [room]);\r\n\r\n  return participants;\r\n}\r\n","import React from 'react';\r\nimport Participant from '../Participant/Participant';\r\nimport { styled } from '@material-ui/core/styles';\r\nimport useParticipants from '../../hooks/useParticipants/useParticipants';\r\nimport useVideoContext from '../../hooks/useVideoContext/useVideoContext';\r\nimport useSelectedParticipant from '../VideoProvider/useSelectedParticipant/useSelectedParticipant';\r\n\r\nconst Container = styled('aside')(({ theme }) => ({\r\n  padding: '0.5em',\r\n  overflowY: 'auto',\r\n  [theme.breakpoints.down('xs')]: {\r\n    overflowY: 'initial',\r\n    overflowX: 'auto',\r\n    padding: 0,\r\n    display: 'flex',\r\n  },\r\n}));\r\n\r\nconst ScrollContainer = styled('div')(({ theme }) => ({\r\n  [theme.breakpoints.down('xs')]: {\r\n    display: 'flex',\r\n  },\r\n}));\r\n\r\nexport default function ParticipantStrip() {\r\n  const {\r\n    room: { localParticipant },\r\n  } = useVideoContext();\r\n  const participants = useParticipants();\r\n  const [selectedParticipant, setSelectedParticipant] = useSelectedParticipant();\r\n\r\n  return (\r\n    <Container>\r\n      <ScrollContainer>\r\n        <Participant\r\n          participant={localParticipant}\r\n          isSelected={selectedParticipant === localParticipant}\r\n          onClick={() => setSelectedParticipant(localParticipant)}\r\n        />\r\n        {participants.map(participant => (\r\n          <Participant\r\n            key={participant.sid}\r\n            participant={participant}\r\n            isSelected={selectedParticipant === participant}\r\n            onClick={() => setSelectedParticipant(participant)}\r\n          />\r\n        ))}\r\n      </ScrollContainer>\r\n    </Container>\r\n  );\r\n}\r\n","import React from 'react';\r\nimport clsx from 'clsx';\r\nimport { makeStyles } from '@material-ui/core/styles';\r\nimport { LocalVideoTrack, Participant, RemoteVideoTrack } from 'twilio-video';\r\n\r\nimport BandwidthWarning from '../BandwidthWarning/BandwidthWarning';\r\nimport useIsTrackSwitchedOff from '../../hooks/useIsTrackSwitchedOff/useIsTrackSwitchedOff';\r\nimport usePublications from '../../hooks/usePublications/usePublications';\r\nimport useTrack from '../../hooks/useTrack/useTrack';\r\nimport VideocamOff from '@material-ui/icons/VideocamOff';\r\n\r\nconst useStyles = makeStyles({\r\n  container: {\r\n    position: 'relative',\r\n    display: 'flex',\r\n    alignItems: 'center',\r\n    gridArea: 'participantList',\r\n  },\r\n  isVideoSwitchedOff: {\r\n    '& video': {\r\n      filter: 'blur(4px) grayscale(1) brightness(0.5)',\r\n    },\r\n  },\r\n  identity: {\r\n    background: 'rgba(0, 0, 0, 0.7)',\r\n    padding: '0.1em 0.3em',\r\n    margin: '1em',\r\n    fontSize: '1.2em',\r\n    display: 'inline-flex',\r\n    '& svg': {\r\n      marginLeft: '0.3em',\r\n    },\r\n  },\r\n  infoContainer: {\r\n    position: 'absolute',\r\n    zIndex: 1,\r\n    height: '100%',\r\n    padding: '0.4em',\r\n    width: '100%',\r\n  },\r\n});\r\n\r\ninterface MainParticipantInfoProps {\r\n  participant: Participant;\r\n  children: React.ReactNode;\r\n}\r\n\r\nexport default function MainParticipantInfo({ participant, children }: MainParticipantInfoProps) {\r\n  const classes = useStyles();\r\n\r\n  const publications = usePublications(participant);\r\n  const videoPublication = publications.find(p => p.trackName.includes('camera'));\r\n  const screenSharePublication = publications.find(p => p.trackName.includes('screen'));\r\n  const isVideoEnabled = Boolean(videoPublication);\r\n\r\n  const videoTrack = useTrack(screenSharePublication || videoPublication);\r\n  const isVideoSwitchedOff = useIsTrackSwitchedOff(videoTrack as LocalVideoTrack | RemoteVideoTrack);\r\n\r\n  return (\r\n    <div\r\n      data-cy-main-participant\r\n      className={clsx(classes.container, { [classes.isVideoSwitchedOff]: isVideoSwitchedOff })}\r\n    >\r\n      <div className={classes.infoContainer}>\r\n        <h4 className={classes.identity}>\r\n          {participant.identity}\r\n          {!isVideoEnabled && <VideocamOff />}\r\n        </h4>\r\n      </div>\r\n      {isVideoSwitchedOff && <BandwidthWarning />}\r\n      {children}\r\n    </div>\r\n  );\r\n}\r\n","import MainParticipantInfo from '../MainParticipantInfo/MainParticipantInfo';\r\nimport ParticipantTracks from '../ParticipantTracks/ParticipantTracks';\r\nimport React from 'react';\r\nimport useMainSpeaker from '../../hooks/useMainSpeaker/useMainSpeaker';\r\nimport useSelectedParticipant from '../VideoProvider/useSelectedParticipant/useSelectedParticipant';\r\nimport useScreenShareParticipant from '../../hooks/useScreenShareParticipant/useScreenShareParticipant';\r\n\r\nexport default function MainParticipant() {\r\n  const mainParticipant = useMainSpeaker();\r\n  const [selectedParticipant] = useSelectedParticipant();\r\n  const screenShareParticipant = useScreenShareParticipant();\r\n\r\n  const videoPriority =\r\n    mainParticipant === selectedParticipant || mainParticipant === screenShareParticipant ? 'high' : null;\r\n\r\n  return (\r\n    /* audio is disabled for this participant component because this participant's audio \r\n       is already being rendered in the <ParticipantStrip /> component.  */\r\n    <MainParticipantInfo participant={mainParticipant}>\r\n      <ParticipantTracks participant={mainParticipant} disableAudio enableScreenShare videoPriority={videoPriority} />\r\n    </MainParticipantInfo>\r\n  );\r\n}\r\n","import useVideoContext from '../useVideoContext/useVideoContext';\r\nimport useDominantSpeaker from '../useDominantSpeaker/useDominantSpeaker';\r\nimport useParticipants from '../useParticipants/useParticipants';\r\nimport useScreenShareParticipant from '../useScreenShareParticipant/useScreenShareParticipant';\r\nimport useSelectedParticipant from '../../components/VideoProvider/useSelectedParticipant/useSelectedParticipant';\r\n\r\nexport default function useMainSpeaker() {\r\n  const [selectedParticipant] = useSelectedParticipant();\r\n  const screenShareParticipant = useScreenShareParticipant();\r\n  const dominantSpeaker = useDominantSpeaker();\r\n  const participants = useParticipants();\r\n  const {\r\n    room: { localParticipant },\r\n  } = useVideoContext();\r\n\r\n  // The participant that is returned is displayed in the main video area. Changing the order of the following\r\n  // variables will change the how the main speaker is determined.\r\n  return selectedParticipant || screenShareParticipant || dominantSpeaker || participants[0] || localParticipant;\r\n}\r\n","import React from 'react';\r\nimport ParticipantStrip from '../ParticipantStrip/ParticipantStrip';\r\nimport { styled } from '@material-ui/core/styles';\r\nimport MainParticipant from '../MainParticipant/MainParticipant';\r\n\r\nconst Container = styled('div')(({ theme }) => ({\r\n  position: 'relative',\r\n  height: '100%',\r\n  display: 'grid',\r\n  gridTemplateColumns: `${theme.sidebarWidth}px 1fr`,\r\n  gridTemplateAreas: '\". participantList\"',\r\n  gridTemplateRows: '100%',\r\n  [theme.breakpoints.down('xs')]: {\r\n    gridTemplateAreas: '\"participantList\" \".\"',\r\n    gridTemplateColumns: `auto`,\r\n    gridTemplateRows: `calc(100% - ${theme.sidebarMobileHeight + 12}px) ${theme.sidebarMobileHeight + 6}px`,\r\n    gridGap: '6px',\r\n  },\r\n}));\r\n\r\nexport default function Room() {\r\n  return (\r\n    <Container>\r\n      <ParticipantStrip />\r\n      <MainParticipant />\r\n    </Container>\r\n  );\r\n}\r\n","import React from 'react';\r\nimport { styled } from '@material-ui/core/styles';\r\n\r\nimport Controls from './components/Controls/Controls';\r\nimport LocalVideoPreview from './components/LocalVideoPreview/LocalVideoPreview';\r\nimport MenuBar from './components/MenuBar/MenuBar';\r\nimport ReconnectingNotification from './components/ReconnectingNotification/ReconnectingNotification';\r\nimport Room from './components/Room/Room';\r\n\r\nimport useHeight from './hooks/useHeight/useHeight';\r\nimport useRoomState from './hooks/useRoomState/useRoomState';\r\nimport { useAppState } from './state';\r\n\r\nconst Container = styled('div')({\r\n  display: 'grid',\r\n  gridTemplateRows: 'auto 1fr',\r\n});\r\n\r\nconst Main = styled('main')({\r\n  overflow: 'hidden',\r\n});\r\n\r\nexport default function App() {\r\n  const roomState = useRoomState();\r\n  const { user, getToken, isFetching } = useAppState();\r\n\r\n  // Here we would like the height of the main container to be the height of the viewport.\r\n  // On some mobile browsers, 'height: 100vh' sets the height equal to that of the screen,\r\n  // not the viewport. This looks bad when the mobile browsers location bar is open.\r\n  // We will dynamically set the height with 'window.innerHeight', which means that this\r\n  // will look good on mobile browsers even after the location bar opens or closes.\r\n  const height = useHeight();\r\n\r\n  return (\r\n    <Container style={{ height }}>\r\n      <MenuBar />\r\n      <Main>\r\n        {roomState === 'disconnected' ? <LocalVideoPreview /> : <Room />}\r\n        <Controls />\r\n      </Main>\r\n      <ReconnectingNotification />\r\n    </Container>\r\n  );\r\n}\r\n","import { useEffect, useState } from 'react';\r\n\r\nexport default function useHeight() {\r\n  const [height, setHeight] = useState(window.innerHeight * (window.visualViewport?.scale || 1));\r\n\r\n  useEffect(() => {\r\n    const onResize = () => {\r\n      setHeight(window.innerHeight * (window.visualViewport?.scale || 1));\r\n    };\r\n\r\n    window.addEventListener('resize', onResize);\r\n    return () => {\r\n      window.removeEventListener('resize', onResize);\r\n    };\r\n  });\r\n\r\n  return height + 'px';\r\n}\r\n","import React, { PropsWithChildren } from 'react';\r\nimport Button from '@material-ui/core/Button';\r\nimport Dialog from '@material-ui/core/Dialog';\r\nimport DialogContent from '@material-ui/core/DialogContent';\r\nimport DialogActions from '@material-ui/core/DialogActions';\r\nimport DialogTitle from '@material-ui/core/DialogTitle';\r\nimport DialogContentText from '@material-ui/core/DialogContentText';\r\nimport enhanceMessage from './enhanceMessage';\r\nimport { TwilioError } from 'twilio-video';\r\n\r\ninterface ErrorDialogProps {\r\n  dismissError: Function;\r\n  error: TwilioError | null;\r\n}\r\n\r\nfunction ErrorDialog({ dismissError, error }: PropsWithChildren<ErrorDialogProps>) {\r\n  const { message, code } = error || {};\r\n  const enhancedMessage = enhanceMessage(message, code);\r\n\r\n  return (\r\n    <Dialog open={error !== null} onClose={() => dismissError()} fullWidth={true} maxWidth=\"xs\">\r\n      <DialogTitle>ERROR</DialogTitle>\r\n      <DialogContent>\r\n        <DialogContentText>{enhancedMessage}</DialogContentText>\r\n        {code && (\r\n          <pre>\r\n            <code>Error Code: {code}</code>\r\n          </pre>\r\n        )}\r\n      </DialogContent>\r\n      <DialogActions>\r\n        <Button onClick={() => dismissError()} color=\"primary\" autoFocus>\r\n          OK\r\n        </Button>\r\n      </DialogActions>\r\n    </Dialog>\r\n  );\r\n}\r\n\r\nexport default ErrorDialog;\r\n","// This function is used to provide error messages to the user that are\r\n// different than the error messages provided by the SDK.\r\nexport default function enhanceMessage(message = '', code?: number) {\r\n  switch (code) {\r\n    case 20101: // Invalid token error\r\n      return message + '. Please make sure you are using the correct credentials.';\r\n    default:\r\n      return message;\r\n  }\r\n}\r\n","import { createMuiTheme } from '@material-ui/core';\r\n\r\ndeclare module '@material-ui/core/styles/createMuiTheme' {\r\n  interface Theme {\r\n    sidebarWidth: number;\r\n    sidebarMobileHeight: number;\r\n  }\r\n\r\n  // allow configuration using `createMuiTheme`\r\n  interface ThemeOptions {\r\n    sidebarWidth?: number;\r\n    sidebarMobileHeight?: number;\r\n  }\r\n}\r\n\r\nexport default createMuiTheme({\r\n  palette: {\r\n    type: 'light',\r\n    primary: {\r\n      main: '#3e4bb2',\r\n    },\r\n  },\r\n  sidebarWidth: 260,\r\n  sidebarMobileHeight: 90,\r\n});\r\n","import { ConnectOptions } from 'twilio-video';\r\nimport { isMobile, removeUndefineds } from '..';\r\nimport { getResolution } from '../../state/settings/renderDimensions';\r\nimport { useAppState } from '../../state';\r\n\r\nexport default function useConnectionOptions() {\r\n  const { roomType, settings } = useAppState();\r\n\r\n  // See: https://media.twiliocdn.com/sdk/js/video/releases/2.0.0/docs/global.html#ConnectOptions\r\n  // for available connection options.\r\n  const connectionOptions: ConnectOptions = {\r\n    // Bandwidth Profile, Dominant Speaker, and Network Quality\r\n    // features are only available in Small Group or Group Rooms.\r\n    // Please set \"Room Type\" to \"Group\" or \"Small Group\" in your\r\n    // Twilio Console: https://www.twilio.com/console/video/configure\r\n    bandwidthProfile: {\r\n      video: {\r\n        mode: settings.bandwidthProfileMode,\r\n        dominantSpeakerPriority: settings.dominantSpeakerPriority,\r\n        renderDimensions: {\r\n          low: getResolution(settings.renderDimensionLow),\r\n          standard: getResolution(settings.renderDimensionStandard),\r\n          high: getResolution(settings.renderDimensionHigh),\r\n        },\r\n        maxTracks: Number(settings.maxTracks),\r\n      },\r\n    },\r\n    dominantSpeaker: true,\r\n    networkQuality: { local: 1, remote: 1 },\r\n\r\n    // Comment this line if you are playing music.\r\n    maxAudioBitrate: Number(settings.maxAudioBitrate),\r\n\r\n    // VP8 simulcast enables the media server in a Small Group or Group Room\r\n    // to adapt your encoded video quality for each RemoteParticipant based on\r\n    // their individual bandwidth constraints. Simulcast should be disabled if\r\n    // you are using Peer-to-Peer Rooms.\r\n    preferredVideoCodecs: [{ codec: 'VP8', simulcast: roomType !== 'peer-to-peer' }],\r\n  };\r\n\r\n  // For mobile browsers, limit the maximum incoming video bitrate to 2.5 Mbps.\r\n  if (isMobile && connectionOptions?.bandwidthProfile?.video) {\r\n    connectionOptions!.bandwidthProfile!.video!.maxSubscriptionBitrate = 2500000;\r\n  }\r\n\r\n  // Here we remove any 'undefined' values. The twilio-video SDK will only use defaults\r\n  // when no value is passed for an option. It will throw an error when 'undefined' is passed.\r\n  return removeUndefineds(connectionOptions);\r\n}\r\n","import React from 'react';\r\nimport Video from 'twilio-video';\r\nimport { Container, Link, Typography, Paper, Grid } from '@material-ui/core';\r\nimport { makeStyles } from '@material-ui/core/styles';\r\n\r\nconst useStyles = makeStyles({\r\n  container: {\r\n    marginTop: '2.5em',\r\n  },\r\n  paper: {\r\n    padding: '1em',\r\n  },\r\n  heading: {\r\n    marginBottom: '0.4em',\r\n  },\r\n});\r\n\r\nexport default function({ children }: { children: React.ReactElement }) {\r\n  const classes = useStyles();\r\n\r\n  if (!Video.isSupported) {\r\n    return (\r\n      <Container>\r\n        <Grid container justify=\"center\" className={classes.container}>\r\n          <Grid item xs={12} sm={6}>\r\n            <Paper className={classes.paper}>\r\n              <Typography variant=\"h4\" className={classes.heading}>\r\n                Browser or context not supported\r\n              </Typography>\r\n              <Typography>\r\n                Please open this application in one of the{' '}\r\n                <Link\r\n                  href=\"https://www.twilio.com/docs/video/javascript#supported-browsers\"\r\n                  target=\"_blank\"\r\n                  rel=\"noopener\"\r\n                >\r\n                  supported browsers\r\n                </Link>\r\n                .\r\n                <br />\r\n                If you are using a supported browser, please ensure that this app is served over a{' '}\r\n                <Link\r\n                  href=\"https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts\"\r\n                  target=\"_blank\"\r\n                  rel=\"noopener\"\r\n                >\r\n                  secure context\r\n                </Link>{' '}\r\n                (e.g. https or localhost).\r\n              </Typography>\r\n            </Paper>\r\n          </Grid>\r\n        </Grid>\r\n      </Container>\r\n    );\r\n  }\r\n\r\n  return children;\r\n}\r\n","import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\n\r\nimport { CssBaseline } from '@material-ui/core';\r\nimport { MuiThemeProvider } from '@material-ui/core/styles';\r\n\r\nimport App from './App';\r\nimport AppStateProvider, { useAppState } from './state';\r\nimport { BrowserRouter as Router, Redirect, Route, Switch } from 'react-router-dom';\r\nimport ErrorDialog from './components/ErrorDialog/ErrorDialog';\r\nimport LoginPage from './components/LoginPage/LoginPage';\r\nimport PrivateRoute from './components/PrivateRoute/PrivateRoute';\r\nimport theme from './theme';\r\nimport './types';\r\nimport { VideoProvider } from './components/VideoProvider';\r\nimport useConnectionOptions from './utils/useConnectionOptions/useConnectionOptions';\r\nimport UnsupportedBrowserWarning from './components/UnsupportedBrowserWarning/UnsupportedBrowserWarning';\r\n\r\nimport './style.scss'\r\n\r\nconst VideoApp = () => {\r\n  const { error, setError } = useAppState();\r\n  const connectionOptions = useConnectionOptions();\r\n\r\n  return (\r\n    <UnsupportedBrowserWarning>\r\n      <VideoProvider options={connectionOptions} onError={setError}>\r\n        <ErrorDialog dismissError={() => setError(null)} error={error} />\r\n        <App />\r\n      </VideoProvider>\r\n    </UnsupportedBrowserWarning>\r\n  );\r\n};\r\n\r\n\r\nconst VideoScreen = () => \r\n  <div className=\"video-room\">\r\n    <MuiThemeProvider theme={theme}>\r\n      <CssBaseline />\r\n      <AppStateProvider>\r\n        <VideoApp />\r\n      </AppStateProvider>\r\n    </MuiThemeProvider>\r\n  </div>\r\n\r\nexport default VideoScreen\r\n\r\n  "],"sourceRoot":""}